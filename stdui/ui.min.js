/**
    Std UI Kit Library v0.1
    http://ui.StdJS.com
*/
!function(t,e,n){Std.css({".StdUI_Image":{outline:"none",overflow:"hidden",">":{img:{"float":"left",width:"100%",height:"100%",border:0}}}}),Std.ui.module("Image",{parent:"widget",action:{content:"value"},option:{defaultClass:"StdUI_Image",level:1,width:22,height:22,type:"stretch",value:"",zoom:!0,gray:!1},"public":{zoom:function(t){var e=this,n=e.D;return e.opt("zoom",t,function(){n.img&&n.img&&n.img.css(t?{width:"100%",height:"100%"}:{width:"auto",height:"auto"})})},toBase64:function(){var t=this,e=newDom("canvas").dom,n=e.getContext("2d");e.width=t._image.width,e.height=t._image.height,n.drawImage(t._image,0,0);var i=n.getImageData(0,0,e.width,e.height);return n.putImageData(i,0,0,0,0,i.width,i.height),e.toDataURL()},value:function(t){var e=this,n=e.D;return this.opt("value",t,function(){e._image=null,n.img||(e[0].append(n.img=newDom("img")),e.zoom(e.opts.zoom)),Std.loader.image(t,function(i,o){i!==!1&&(n.img.attr("src",t).show(),e.emit("load",e._image=o).gray(e.opts.gray))})})},gray:function(t){var e=this;return e.opt("gray",t,function(){var n=e.opts.value;isEmpty(n)||null===e._image||t!==!1&&(Std.is.ie()?e[0].css("filter","grayscale(100%)"):e[0].css("filter",t?"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)":""),e.emit("gray",t))})}},main:function(t){t.D={},t.call_opts("value",!0)}}),Std.ui.module("Item",{parent:"widget",action:{content:"text"},option:{level:2,defaultClass:"StdUI_Item",text:"",icon:null,value:null,tabIndex:null,iconClass:null,iconWidth:null,iconHeight:null,verticalAlign:"top"},"private":{textVisible:!0},extend:{beforeRender:function(){this.call_opts({text:"",value:null,icon:null,iconClass:null},!0)},width:function(){var t=this,e=t.opts,n=t.D,i=t.width();isNumber(e.iconWidth)&&n.icon&&i-t.boxSize.width<=e.iconWidth?t._textVisible&&n.text&&(n.text.hide(),t._textVisible=!1):!t._textVisible&&n.text&&(n.text.show(),t._textVisible=!0)},height:function(){var t=this,e=t.opts,n=e.verticalAlign;if("top"!==n&&"none"!==n){var i=t.D,o=t.height()-t.boxSize.height,r=0,a=0;"middle"===n?(isNumber(e.iconHeight)&&(r=(o-e.iconHeight)/2),a=o):"bottom"===n&&(isNumber(e.iconHeight)&&(r=o-e.iconHeight),a=2*o),i.icon&&isNumber(e.iconHeight)&&i.icon.marginTop(r),i.text&&i.text.lineHeight(a)}}},"protected":{initIcon:function(){var t=this,e=t.D,n=e.icon=newDiv("_icon");return e.text?n.insertBefore(e.text):n.appendTo(t[0]),t.call_opts({iconWidth:null,iconHeight:null},!0)}},"public":{verticalAlign:function(t){return this.opt("verticalAlign",t)},iconWidth:function(t){var e=this;return e.opt("iconWidth",t,function(){e.D.icon&&e.D.icon.width(t)})},iconHeight:function(t){var e=this;return e.opt("iconHeight",t,function(){e.D.icon&&e.D.icon.height(t)})},iconClass:function(t){var e=this,n=e.D;return e.opt("iconClass",t,function(){n.icon||e.initIcon(),n.icon.className("_icon "+t)})},text:function(t){var e=this;return e.opt("text",t,function(){e.D.text||(e.D.text=newDiv("_text").appendTo(e[0])),e.D.text.html(t)})},icon:function(t){var e=this,n=e.D;return e.opt("icon",t,function(){n.icon||e.initIcon(),n.iconImg||(n.iconImg=newDom("img").appendTo(n.icon)),n.iconImg.attr("src",t)})},edit:function(t){if(!this._editState){var e=this,n=e.D,i=n.text.html(),o=null,r=newDom("input","_edit"),a=newDom("span").css({top:-99,font:n.text.css("font"),fontSize:n.text.css("fontSize"),position:"absolute",visibility:"hidden",padding:r.css("padding")}).text(i).appendTo(e[0]);r.on({mousedown:function(t){t.stopPropagation()},keydown:function(t){13===t.keyCode?r.blur():(clearTimeout(o),o=setTimeout(function(){r.width(a.text(r.value()).width())},1))},blur:function(){var o=r.value();n.text.show(),isFunction(t)&&t.call(e.text(o),i,o),r.remove(),e._editState=!1}}).appendTo(e).focus().css({"float":n.text.css("float"),width:a.width(),height:n.text.height()}).value(i).select(),n.text.hide(),e._editState=!0}}},main:function(t,e,n){t.D={},isFunction(e.click)&&n.on("click",function(){t.enable()&&e.click.call(t)})}}),Std.ui.module("TemplateItem",{parent:"widget",events:"templateRender",action:{content:"text"},option:{level:2,defaultClass:"StdUI_TemplateItem",text:"",data:null,value:null,tabIndex:null,template:null,textField:"text",valueField:"value"},extend:{render:function(){var t=this;t.call_opts({data:null},!0)}},"public":{text:function(t){return this.opt("text",t)},template:function(t){var e=this,n=e.opts;return e.opt("template",t,function(){isString(t)?n.template=Std.template(t):t instanceof Std.template&&(n.template=t)})},data:function(t){var e=this,i=e.opts;if(t===n)return i.data;var o=e.template();return(isString(t)||isNumber(t))&&(t={value:t}),isObject(o)&&(o.renderTo(e,t),e.emit("templateRender")),e.text(t[i.textField]),e.value(t[i.valueField]),i.data=t,e}},main:function(t,e,n){t.D={},e.template&&t.template(e.template),isFunction(e.click)&&n.on("click",function(){t.enable()&&e.click.call(t)})}}),Std.ui.module("Button",{nodeName:"a",parent:"widget",events:"checked mousedown mouseup click press longpress focus blur",action:{content:"text"},option:{level:2,text:"Button",href:"",menu:null,link:!1,icon:null,iconClass:null,target:"_blank",defaultClass:"StdUI_Button",checkable:!1,checked:!1,styleType:"text",iconWidth:18,iconHeight:18,boxSizing:"border-box"},extend:{render:function(){this.initEvents(),this.initMouse()},width:function(t){var e=this,n=e.D.table;isNumber(t)?n.width(t-e.boxSize.width):n.width(t)},height:function(t){var e=this,n=e.D.table;isNumber(t)?n.height(t-e.boxSize.height):n.height(t)}},"protected":{press:function(){var t=this,e=t.opts;return Std.func(e.press).call(t),e.checkable&&t.checked(!e.checked),t.emit("press")},initButtonBox:function(){var t=this;return t.D.tbody=newDom("tbody").appendTo(t.D.table=newDom("table","_buttonBox _"+t.opts.styleType).appendTo(t[0])),t},initEvents:function(){var t=this,e=!1;return t[0].on("focusin",function(){t.addClass("focus").emit("focus"),e===!1&&(t.initKeyboard().on("focusout",function(){t.emit("blur"),t[0].removeClass("focus")}),e=!0)}),t},initMouse:function(){var t=this,e=t.opts;return t[0].mouse({unselect:!0,down:function(e){t.emit("mousedown",e)},up:function(e){t.emit("mouseup",e)},click:function(n){e.enable&&(t.press().emit("click",n),Std.func(e.click).call(t,n))},longpress:function(e){t.emit("longpress",e)}}),t},initKeyboard:function(){var t=this;return t[0].keyboard({classStatus:!0,keyCode:function(t){return 32===t.which||13===t.which?!0:void 0},down:function(t){t.preventDefault()},press:function(){return t.opts.enable?(t.press(),!1):void 0}}),t},initElements:function(){var t=this.initButtonBox(),e=t.opts,n=t.D;switch(e.styleType){case"text":n.tr1=newDom("tr").append([n.text=newDom("td","_text")]).appendTo(n.tbody);break;case"icon":n.tr1=newDom("tr").append([newDom("td").append(n.icon=newDiv("_icon"))]).appendTo(n.tbody);break;case"textBesideIcon":n.tr1=newDom("tr").append([newDom("td").append(n.icon=newDiv("_icon")),n.text=newDom("td","_text")]).appendTo(n.tbody);break;case"textUnderIcon":n.tbody.append([n.tr1=newDom("tr").append(newDom("td").append(n.icon=newDiv("_icon"))),n.tr2=newDom("tr").append(n.text=newDom("td","_text"))])}return t}},"public":{checkable:function(t){return this.opt("checkable",t)},href:function(t){return this.opt("href",t,function(){this[0].attr("href",t)})},target:function(t){return this.opt("target",t,function(){this[0].attr("target",t)})},iconWidth:function(t){var e=this;return e.opt("iconWidth",t,function(){e.D.icon&&e.D.icon.width(t)})},iconHeight:function(t){var e=this;return e.opt("iconHeight",t,function(){e.D.icon&&e.D.icon.height(t)})},link:function(t){var e=this,n=e.opts;return e.opt("link",t,function(){t===!0?(e.target(n.target),e.href(n.href)):e[0].removeAttr("href")})},text:function(t){var e=this,n=e.D;return e.opt("text",t,function(){"icon"!==e.opts.styleType&&n.text.html(t)})},checked:function(t){var e=this;return e.checkable()?e.opt("checked",t,function(){return e.toggleClass("checked",t).emit("checked",t)}):t===n?e.opts.checked:e},icon:function(t){var e=this,n=e.D;return e.opt("icon",t,function(){"text"!==e.opts.styleType&&(n.iconImg||(n.iconImg=newDom("img").appendTo(n.icon)),n.iconImg.attr("src",t))})},iconClass:function(t){var e=this,n=e.D;return e.opt("iconClass",t,function(){"text"!==e.opts.styleType&&n.icon.className("_icon "+t)})},styleType:function(t){var e=this,n=e.opts;return e.opt("styleType",t,function(){e.D.table&&Std.each(e.D,function(t,n){n.remove(),delete e.D[t]}),e.initElements(),e.call_opts("text").call_opts({icon:null,iconClass:null,checked:!1,link:!1},!0),e.iconWidth(n.iconWidth).iconHeight(n.iconHeight)})}},main:function(t,e){t.D={},t.styleType(e.styleType)}}),Std.ui.module("ToolButton",{nodeName:"a",parent:"Button",option:{defaultClass:"StdUI_Button StdUI_ToolButton",tabIndex:null,height:32,iconWidth:24,iconHeight:24,text:""}}),Std.css({".StdUI_Label":{"float":"left",fontSize:"12px",color:"#3B3B3B",overflow:"hidden",textOverflow:"ellipsis",textDecoration:"none"}}),Std.ui.module("Label",{parent:"widget",nodeName:"a",action:{content:"value"},option:{defaultClass:"StdUI_Label",level:1,bold:!1,underline:!1,wordwrap:!1,wordnowrap:!1,textAlign:null,color:null,fontSize:12,lineHeight:null,indent:0,href:null,target:null,value:"label",background:"",textFormat:"html"},"public":{textFormat:function(t){return this.opt("textFormat",t)},href:function(t){return this.opt("href",t,function(){this[0].attr("href",t)})},target:function(t){return this.opt("target",t,function(){this[0].attr("target",t)})},wordwrap:function(t){var e=this;return e.opt("wordwrap",t,function(){e.toggleClass("Std_wordwrap",t)})},wordnowrap:function(t){var e=this;return e.opt("wordnowrap",t,function(){e.toggleClass("Std_wordnowrap",t)})},value:function(t){var e=this;return e.opt("value",t,function(){e[0][e.opts.textFormat](t)})},color:function(t){var e=this;return t===n?e[0].color():(e[0].color(t),e)},fontSize:function(t){return this.opt("fontSize",t,function(){this[0].css("font-size",t+"px")})},lineHeight:function(t){var e=this;return t===n?e[0].css("lineHeight"):e[0].css("lineHeight",t)},bold:function(t){var e=this;return e.opt("state",t,function(){e[0].css("font-weight",t?"bold":"")})},underline:function(t){var e=this;return e.opt("underline",t,function(){e[0].css("text-decoration",t?"underline":"")})},indent:function(t){return this.opt("indent",t,function(){this[0].css("text-indent",t+"px")})},background:function(t){return this.opt("background",t,function(){this[0].css("background",t)})},textAlign:function(t){return this.opt("textAlign",t,function(){this[0].css("text-align",t)})}},main:function(t){t.call_opts({bold:!1,indent:0,underline:!1,background:""},!0),t.call_opts(["fontSize","color","wordwrap","wordnowrap","lineHeight","textAlign","href","target"],!0),t.call_opts("value")}}),Std.model("ui.Edit",{parent:"widget",action:{content:"value"},option:{value:"",echoMode:"text",boxSizing:"border-box",fontSize:null,maxLength:0,readOnly:!1,showState:!1,placeHolder:null},events:"focus blur change","private":{inputNodeName:"input",placeHolderState:!0},extend:{enable:function(t){var e=this,n=e.D.input,i="disabled";t===!1?n.attr(i,i):n.removeAttr(i)}},"protected":{initEvents:function(){var t=this,e=!1,n=function(){t.removeClass("focus"),t.showState()&&(t.valid()?t.addClass("_state _success"):t.addClass("_state _error"))};return t[0].on("focusin",function(){0!=t.enable()&&(t.showState()&&t.removeClass("_state _success _error"),setTimeout(function(){t.addClass("focus").emit("focus").focus()},20),e!==!0&&(t.D.input.on("change",function(){t.emit("change")}),t[0].on("focusout",n),e=!0))}).mouse(),t},initPlaceHolder:function(){var t=this,e=t.opts;return t.D.placeHolder||(t.D.placeHolder=newDiv("_placeHolder").appendTo(t[0]).unselect(!0)),""!==e.value?t.placeHolderState(!1):t._placeHolderState=!0,t},initInput:function(t){var e=this,n=e.opts,i=e.D;return i.input="password"===n.echoMode?new Std.dom(e._inputNodeName+"[type='password']"):newDom(e._inputNodeName),isEmpty(t)||i.input.value(t),i.input.appendTo(e[0]).on("keydown keyup",Std.func(function(){e.placeHolderState(""===e.value())},5)),e}},"public":{showState:function(t){return this.opt("showState",t)},select:function(){var t=this;return t.D.input.select(),t},focus:function(){var t=this;return t.D.input.focus(),t},blur:function(){var t=this;return t.D.input.blur(),t},maxLength:function(t){var e=this;return e.opt("maxlength",t,function(){e.D.input.attr("maxlength",t)})},lineHeight:function(t){var e=this;return e.opt("lineHeight",t,function(){e.D.input.lineHeight(t)})},fontSize:function(t){var e=this;return t==n?e.D.input.css("font-size"):(e.D.input.css("font-size",t),e.D.placeHolder&&e.D.placeHolder.css("font-size",t),e)},value:function(t){var e=this,i=e.D;return t===n?i.input.value():(null==t&&(t=""),e.placeHolderState(""===t),i.input.value(t),e)},echoMode:function(t){var e=this;return e.opt("echoMode",t,function(){var t="";t=e.renderState?e.value():e.opts.value,e.D.input&&(e.D.input.remove(),delete e.D.input),e.initInput(t)})},readOnly:function(t){var e=this,n=e.D.input;return e.opt("readOnly",t,function(){t===!0?n.attr("readOnly","readOnly"):n.attr("readOnly","")})},placeHolder:function(t){var e=this,n=e.D;return e.opt("placeHolder",t,function(){n.placeHolder||e.initPlaceHolder(),n.placeHolder.html(t)})},placeHolderState:function(t){var e=this,i=e.D;return t===n?e._placeHolderState:t!==e._placeHolderState&&i.placeHolder?(i.placeHolder.visible(e._placeHolderState=t),e):e}},main:function(t,e){t.D={},t.echoMode(e.echoMode),t.call_opts({value:"",readOnly:!1,maxLength:0,placeHolder:null},!0),t.call_opts({fontSize:null},!0),t.initEvents()}}),Std.ui.module("LineEdit",{model:"ui.Edit",option:{level:3,dataList:null,minWidth:12,minHeight:12,defaultClass:"StdUI_LineEdit"},"private":{inputNodeName:"input"},extend:{height:function(t){var e=this;isNumber(t)||(t=e.height()),e.D.input.height(t-=e.boxSize.height),e.D.placeHolder&&e.D.placeHolder.css({height:t,lineHeight:t}),e.lineHeight(t)}},"public":{dataList:function(t){var e=this;return e.opt("dataList",t,function(){})}}}),Std.ui.module("TextEdit",{model:"ui.Edit",option:{level:4,minWidth:15,minHeight:20,defaultClass:"StdUI_TextEdit"},"private":{inputNodeName:"textarea"},extend:{height:function(t){var e=this;isNumber(t)&&e.D.input.height(t-=e.boxSize.height)},lineHeight:function(t){var e=this;e.D.placeHolder&&e.D.placeHolder.lineHeight(t)}}}),Std.ui.module("CheckBox",{parent:"widget",events:"change",option:{level:1,defaultClass:"StdUI_CheckBox",text:"CheckBox",value:!1,valueType:"bool"},action:{content:"text"},"private":{checked:!1},extend:{render:function(){this.initEvents()}},"protected":{initEvents:function(){var t=this;t[0].mouse({click:function(){t.enable()&&t.checked(!t.checked())}})}},"public":{valueType:function(t){return this.opt("valueType",t)},text:function(t){return this.opt("text",t,function(){this[2].html(t)})},checked:function(t){var e=this;return t===n?e._checked:(e._checked!==t&&(e.toggleClass("checked",e._checked=t),e.renderState&&e.emit("change",t)),e)},value:function(t){var e=this,i=e.valueType();if(t===n){if("any"==i)return e.opts.value;if("bool"==i)return e.checked();if("int"==i)return Number(e.checked())}return"any"==i?e.opts.value=t:e.checked(Boolean(t)),e}},main:function(t,e,n){n.append([t[1]=newDiv("_icon StdUI_CheckBox_Icon"),t[2]=newDom("label","_text")]),t.call_opts(["text","value"])}}),Std.ui.module("RadioBox",{parent:"widget",events:"change",option:{level:1,defaultClass:"StdUI_RadioBox",text:"RadioBox",value:!1,valueType:"bool"},action:{content:"text"},"private":{checked:!1},"static":{connect:function(t){return new(Std.ui("RadioBox").connection)(t)},connection:Std.module({"public":{change:function(t){var e=this;Std.each(e.radios,function(e,n){n.widget!==t&&n.widget.checked(!1)})},connect:Std.func(function(t){if(t instanceof Std.ui("RadioBox")){var e=this,n=function(n){n===!0&&e.change(e.current=t)};e.radios.push({widget:t.checked(!1),handle:n}),t.on("change",n)}},{each:[isArray]}),disconnect:Std.func(function(t){Std.each(this.radios,function(e,n){return n.widget===t?(t.off("change",n.handle),this.remove(e),!1):void 0})},{each:[isArray]}),value:function(t){return t===n?this.current?this.current.value():null:(Std.each(this.radios,function(e,n){return n.widget.value()===t?(n.widget.checked(!0),!1):void 0}),void 0)}},main:function(t){var e=this;e.radios=[],e.connect(t)}})},"protected":{initEvents:function(){var t=this;t[0].mouse({click:function(){t.enable()&&!t.checked()&&t.checked(!0)}})}},"public":{valueType:function(t){return this.opt("valueType",t)},text:function(t){return this.opt("text",t,function(){this[2].html(t)})},checked:function(t){var e=this;return t===n?e._checked:(e._checked!==t&&(e.toggleClass("checked",e._checked=t),e.renderState&&e.emit("change",t)),e)},value:function(t){var e=this,i=e.valueType();return t===n?"any"==i?e.opts.value:"bool"==i?e.checked():~~e.checked():("any"==i?e.opts.value=t:e.checked(Boolean(t)),e)}},main:function(t,e,n){n.append([t[1]=newDiv("_icon StdUI_RadioBox_Icon"),t[2]=newDom("label","_text")]),t.call_opts(["text","value"]),t.initEvents()}}),Std.ui.module("SwitchBox",{parent:"widget",events:"change",option:{level:1,defaultClass:"StdUI_SwitchBox",height:26,value:null,items:null,styleType:"default"},action:{content:"value"},"private":{selected:null},extend:{render:function(){var t=this;t.call_opts(["styleType","value"]),t.repaint()},height:function(t){var e=this;isNumber(t)||(t=e.height()),e[0].lineHeight(t-=e.boxSize.height),e[1]&&e[1].height(t-2).lineHeight(t-2)}},"protected":{length:0,initHandle:function(){var t=this;if(t[1]==n){var e=t.height()-t.boxSize.height-2;t[1]=newDiv("_handle").appendTo(t[0]),t[1].height(e).lineHeight(e)}return t},initEvents:function(){var t=this;return t[0].unselect(!0).delegate("click","._item",function(){if(t.enable()){var e=this.index("._item"),n=t.items[e];n!==t._selected&&(t._selected=n,t.emit("change",t.opts.value=n.value)),t.initHandle()[1].html(n.dom.html()).animate("stop").animate({to:{width:n.dom.width()-2,left:n.dom.offsetLeft()}},100)}}),t},add:function(t,e){var n=this,i=newDiv("_item");return isObject(t)&&(e=t.value,t=t.text),isString(t)&&i.append(newDiv("_name").html(t)),n.length++>0&&n[0].append(newDiv("_sep")),n.items.push({text:t,value:e,dom:i}),n[0].append(i),n}},"public":{styleType:function(t){return this.opt("styleType",t,function(){this.addClass("_"+t)})},refresh:function(){var t=this,e=t.opts.width,n=t._selected;return null===n?t:(t[1]||t.initHandle(),e="auto"===e?n.dom.outerWidth():e/t.length-t.boxSize.width,t[1].dom.innerHTML=n.dom.html(),t[1].css({left:n.dom.offsetLeft(),width:e-2}),t)},repaint:function(){for(var t=this,e=t.items,n=t.opts.width,i=t.boxSize.width,o=0;o<t.length;o++){var r=0;r="auto"===n?e[o].dom.outerWidth()+18:n/t.length-i,e[o].dom.width(0!==o?r+1:r)}return t.refresh()},value:function(t){var e=this;return e.opt("value",t,function(){for(var n=0;n<e.length;n++)if(e.items[n].value===t){e._selected=e.items[n];break}e.renderState&&e.refresh(),e.emit("change",t)})},insert:function(){},append:function(t,e){var n=this;return isArray(t)?Std.each(t,function(t,e){n.add(e)}):n.add(t,e),n.renderState&&n.repaint(),n}},main:function(t,e){t.items=[],t.initEvents(),e.items&&t.append(e.items)}}),Std.ui.module("ColorPicker",{parent:"widget",events:"change",action:{content:"value"},option:{level:3,defaultClass:"StdUI_ColorPicker",boxSizing:"border-box",fixedLayoutWidth:!0,fixedLayoutHeight:!0,minWidth:380,minHeight:220,width:380,height:220,paletteSize:150,value:"#000"},"private":{rollY:0,paletteX:0,paletteY:0},extend:{render:function(){var t=this,e=t.opts;t.value(e.value),t.initPalette(),t.initRoll(),t.initInputs(),t.initColors()}},"protected":{initInputs:function(){var t=this,e=t.D;return e.values.delegate("focusout","input",function(){var n=Std.dom(this),i=n.className().substr(1);switch(i){case"R":case"G":case"B":t.rgb(e.R.value(),e.G.value(),e.B.value());break;case"H":case"S":case"V":t.hsv(e.H.value(),e.S.value(),e.V.value());break;case"HEX":t.hex(e.HEX.value())}}),t},initColors:function(){var t=this,n=t.D,i=Std.convert.colors,o=null,r=Std.dom.fragment(),a=e.createElement("div");a.className="_color";for(var s in i){var l=Std.dom.clone(a);l.style.backgroundColor=i[s],r.appendChild(l)}return n.colors.append(r).delegate("click","._color",function(){null!==o&&o.removeClass("selected"),t.hex(Std.convert.rgb2hex(Std.convert.color((o=Std.dom(this).addClass("selected")).css("background-color"))))}),t},initPalette:function(){var t=this,e=t.D,n=null,i=Std.dom(t[0].document()),o=function(e){t.move1(e.pageX-n.x,e.pageY-n.y).updateUI()};return e.palette.mouse({unselect:!0,down:function(r){n=e.palette.offset(),e.position1.css("visibility","hidden"),t.move1(r.pageX-n.x,r.pageY-n.y).updateUI(),i.on("mousemove",o)},up:function(){i.off({mousemove:o}),e.position1.removeStyle("visibility")}}),t},initRoll:function(){var t=this,e=t.D,n=null,i=Std.dom(t[0].document()),o=function(e){t.move2(e.pageY-n).updateUI()},r=function(){i.off({mouseup:r,mousemove:o})};return e.roll.on("mousedown",function(a){return n=e.roll.offset().y,i.on({mouseup:r,mousemove:o}).once("selectstart",function(){return!1}),t.move2(a.pageY-n).updateUI(),!1}),t},move1:function(t,e){var n=this,i=n.opts.paletteSize;return 0>t?t=0:t>i&&(t=i),0>e?e=0:e>i&&(e=i),n.D.position1.css({left:(n._paletteX=t)-7,top:(n._paletteY=e)-7}),n},move2:function(t){var e=this,n=e.opts.paletteSize;return 0>t?t=0:t>n&&(t=n),e.D.position2.css("top",(e._rollY=t)-4),e},updateUI:function(){var t=this,e=t.D,n=t.hsv(),i=Std.convert.hsv2rgb(n.h,n.s,n.v),o=Std.convert.rgb2hex(i.r,i.g,i.b);return e.R.value(i.r),e.G.value(i.g),e.B.value(i.b),e.H.value(n.h),e.S.value(n.s),e.V.value(n.v),e.HEX.value(o),e.view.css("background-color",o),e.palette.css("background-color",Std.convert.rgb2hex(Std.convert.color("hsv("+n.h+",100,100)"))),t.emit("change",o)}},"public":{value:function(t){var e=this;return t===n?e.hex():(isString(t)&&(t=Std.convert.color(t)),e.rgb(t.r,t.g,t.b))},rgb:function(t,e,i){var o=this;if(t===n)return Std.convert.hsv2rgb(o.hsv());var r=Std.convert.rgb2hsv(t,e,i);return o.hsv(r.h,r.s,r.v)},hex:function(t){var e=this;if(t===n)return Std.convert.rgb2hex(e.rgb());var i=Std.convert.hex2rgb(t);return e.rgb(i.r,i.g,i.b)},hsv:function(t,e,i){var o=this,r=o.opts.paletteSize;return t===n?{h:int((r-o._rollY)*(360/r)),s:int(o._paletteX*(100/r)),v:int((r-o._paletteY)*(100/r))}:(o.move1(o._paletteX=e/(100/r),o._paletteY=r-i/(100/r)),o.move2(o._rollY=r-t/(360/r)),o.updateUI())}},main:function(t,e,n){var i=t.D={};Std.each("client views view palettes palette roll position1 position2 values colors",function(t,e){i[e]=newDiv("_"+e)}),Std.each("R G B HEX H S V",function(t,e){i.values.append(newDiv("_field").append([newDom("span","_label").html(e),i[e]=newDom("input","_"+e)]))}),n.append([i.palettes.append([i.palette.append(i.position1.append(newDiv("inner"))),i.roll.append(i.position2)]),newDiv("_client").append([i.colors,i.views.append([i.view])]),i.values])}}),Std.ui.module("DatePicker",{parent:"widget",events:"dateClick",action:{content:"value"},option:{defaultClass:"StdUI_DatePicker",editable:!0,value:"",minWidth:233,maxWidth:233,boxSizing:"border-box",format:"yyyy-MM-dd hh:mm:ss",footer:!0,position:"none"},extend:{render:function(){var t=this,e=t.opts;t.value(e.value),t.initEvents()}},"protected":{dateCount:function(t,e){var i=this;return t==n?new Date(i.year(),i.month(),0).getDate():new Date(t,e,0).getDate()},clearDates:function(){var t=this,e=t.D.dates;for(var n in e)e[n].remove(),delete e[n];return t},refreshTime:function(){var t=this,e=new Date;return t.hour(e.getHours()),t.minute(e.getMinutes()),t.second(e.getSeconds()),t},updateDates:function(){var t=this,e=t.D,n=e.dates,i=t.dateCount(),o=t.year(),r=t.month(),a=new Date(o,r-1).getDay();t.clearDates();for(var s=1,l=t.dateCount(1>r?o-1:o,1>r?12:r-1);a>=s;s++)e.dateBox.append(n["l"+s]=newDom("span","_date _lastMonthDate").html(l-a+s));for(var s=1;i>=s;s++)e.dateBox.append(n[s]=newDom("span",s===t.date()?"_date selected":"_date").html(s));for(var s=1,u=new Date(t.year(),t.month()).getDay();7-u>=s;s++)e.dateBox.append(n["n"+s]=newDom("span","_date _nextMonthDate").html(s));return t},editValue:function(t,e){var n,i=this;if(!i.editable())return i;"year"===t?n=i.D.year:"month"===t&&(n=i.D.month);var o=newDom("input").insertAfter(n.hide());return o.width(n.outerWidth()-o.boxSize().width).on({focus:function(){var t=function(e){13===e.keyCode&&o.blur().off("keydown",t)},e=function(t){o.is(t.target)||(o.blur(),i[0].off("mousedown",e))};o.on("keydown",t),o.value(n.text()),i[0].on("mousedown",e)},blur:function(){var t=o.value();t.isNumber()&&e.call(n,~~t)&&n.html(t),this.remove(),n.show()}}).focus().select(),i},initFooter:function(){var t=this,e=t.D,n=function(t){return newDom("input",t).contentEditable(!0).attr("maxlength",2).value("00")};return t[0].append(e.footer=newDiv("_footer").append([newDom("span","_label").html("time:"),newDiv("_time").append([e.hour=n("_hour"),newDiv("_and").html(":"),e.minute=n("_minute"),newDiv("_and").html(":"),e.second=n("_second")]),e.refresh=newDiv("_refresh").mouse({click:function(){t.refreshTime()}}),e.today=newDiv("_today").html("Today").mouse({click:function(){var e=new Date;t.year(e.getFullYear()),t.month(e.getMonth()+1),t.date(e.getDate())}})])),e.footer.delegate("keydown keyup","input",function(t){var e=this,n=e.value();if("keydown"===t.name){if(!(t.keyCode>=48&&t.keyCode<=57||t.keyCode>=96&&t.keyCode<=105))return!1}else"keyup"===t.name&&(~~n>23&&0===e.index()?e.value("00"):~~n>59&&e.value("59"))}),t},initEvents:function(){var t=this,e=t.D;return e.prevYear.on("click",function(){t.year(t.year()-1)}),e.nextYear.on("click",function(){t.year(t.year()+1)}),e.prevMonth.on("click",function(){var e=t.month()-1;1>e?(t.year(t.year()-1),t.month(12)):t.month(e)}),e.nextMonth.on("click",function(){var e=t.month()+1;e>12?(t.year(t.year()+1),t.month(1)):t.month(e)}),e.year.on("click",function(){t.editValue("year",function(e){return e>1e3&&1e4>e?(t.year(e),!0):void 0})}),e.month.on("click",function(){t.editValue("month",function(e){return e>0&&13>e?(t.month(e),!0):void 0})}),e.dateBox.on("click",function(e){var n,i=Std.dom(e.target);return this.is(i)?!1:(i.hasClass("_lastMonthDate")?t.month()-1<1?t.year(t.year()-1).month(12):t.month(t.month()-1):i.hasClass("_nextMonthDate")&&(t.month()+1>12?t.year(t.year()+1).month(1):t.month(t.month()+1)),t.date(n=~~i.text()),t.emit("dateClick",n),void 0)}),t}},"public":{format:function(t){return this.opt("format",t)},day:function(){return this._date.getDay()},editable:function(t){return this.opt("editable",t)},year:function(t){var e=this,i=e._date;return t===n?~~i.getFullYear():(i.setFullYear(t),e.D.year.html(t),e.renderState&&e.updateDates(),e)},month:function(t){var e=this,i=e._date;return t===n?~~i.getMonth()+1:(t>12?t=12:1>t&&(t=1),e.date()>e.dateCount(e.year(),t)&&e.date(1),i.setMonth(t-1),e.D.month.html(t),e.renderState&&e.updateDates(),e)},date:function(t){var e=this;if(t===n)return e._date.getDate();var i=e.D.dates,o=e.date();return e._date.setDate(t),i[o]&&i[o].className("_date"),t in i&&i[t].className("_date selected"),e},hour:function(t){var e=this;return t===n?e._date.getHours():(e._date.setHours(t),e.opts.footer&&e.D.hour.value(t),e)},minute:function(t){var e=this;return t===n?e._date.getMinutes():(e._date.setMinutes(t),e.opts.footer&&e.D.minute.value(t),e)},second:function(t){var e=this;return t===n?e._date.getSeconds():(e._date.setSeconds(t),e.opts.footer&&e.D.second.value(t),e)},value:function(t){var e=this,i=e.opts;if(t===n)return e._date.format(i.format);var o=e._date=new Date;return""!==(t=t.trim())&&o.format(i.format,t),e.year(o.getFullYear()),e.month(o.getMonth()+1),e.date(o.getDate()),e.hour(o.getHours()),e.minute(o.getMinutes()),e.second(o.getSeconds()),e.updateDates(),e}},main:function(t,e,n){var i=t.D={dates:{}};n.unselect(!0).append([i.header=newDiv("_header").append([i.prevYear=newDiv("_btn _prevYear"),i.year=newDiv("_value _year"),i.nextYear=newDiv("_btn _nextYear"),i.prevMonth=newDiv("_btn _prevMonth"),i.month=newDiv("_value _month"),i.nextMonth=newDiv("_btn _nextMonth")]),newDiv("_body").append([i.dayBox=newDiv("_dayBox"),i.dateBox=newDiv("_dateBox")])]),Std.each(["Su","Mo","Tu","We","Th","Fr","Sa"],function(t,e){i.dayBox.append(newDom("span","_day").html(e))}),e.footer===!0&&t.initFooter()}}),Std.plugin.module("DatePicker",{events:"apply dateClick",option:{value:"",editable:!0,format:"yyyy-MM-dd h:m:s"},"public":{value:function(t){var e=this;return t===n?e.datePicker.value():(e.datePicker.value(t),e)},remove:function(){this.datePicker.remove()}},main:function(t,e,n){var i=t.datePicker=Std.ui("DatePicker",Std.extend({renderTo:"body",visible:!1},e));i.on({dateClick:function(){i.hide(),t.emit("apply",t.value()),n.value(t.value())}})[0].css("position","absolute"),Std.dom(n).on("click",function(){var t=this.offset();i.show()[0].css({top:t.y+Std.dom(n).outerHeight(),left:t.x,zIndex:Std.ui.status.zIndex++})})}}),Std.ui.module("DateTimeEdit",{parent:"LineEdit",option:{minWidth:32,minHeight:12,defaultClass:"StdUI_DateTimeEdit",format:"yyyy-MM-dd h:m:s"},"private":{picker:null,pickerState:!1},extend:{initEvents:function(){var t=this;t.opts},remove:function(){var t=this;t._picker&&t._picker.remove(),t.removeDocumentEvents()}},"protected":{initHandle:function(){var t=this;return t[0].append(t.D.handle=newDiv("_handle").mouse({click:function(){t._pickerState?t.hidePicker():t.showPicker()}})),t},initPicker:function(){var t=this,e=t.opts,n=t._picker=Std.ui("DatePicker",{footer:e.footer,format:e.format,renderTo:"body"});return isEmpty(t.value())||n.value(t.value()),n.on("dateClick",function(){t.hidePicker(),t.value(n.value())}),n[0].css("position","absolute"),t},addDocumentEvents:function(){var t=this;return Std.dom(e).on("mousedown",t._documentEvents||(t._documentEvents=function(e){t[0].contains(e.target)||t._picker[0].contains(e.target)||(t.hidePicker(),t.removeDocumentEvents())})),t},removeDocumentEvents:function(){var t=this;return t._documentEvents&&Std.dom(e).off("mousedown",t._documentEvents),t}},"public":{showPicker:function(){var t=this;t._picker||t.initPicker();var n=t._picker,i=t[0].offset(),o=i.y+t.height();return n[0].removeClass("StdUI_DateTimeEdit_Animate2").addClass("StdUI_DateTimeEdit_Animate1").css({top:o+n.height()>=Std.dom(e).height()?i.y-n.height():o,left:i.x,zIndex:Std.ui.status.zIndex++}),t.addDocumentEvents(),t._pickerState=!0,t},hidePicker:function(){var t=this,e=t._picker;return e[0].removeClass("StdUI_DateTimeEdit_Animate1").addClass("StdUI_DateTimeEdit_Animate2"),t.removeDocumentEvents(),t._pickerState=!1,t}},main:function(t){t.initHandle()}}),Std.ui.module("DateTimeView",{parent:"widget",option:{type:"dateTime",width:100,height:30,minWidth:32,minHeight:20,fontSize:13,tabIndex:null,defaultClass:"StdUI_DateTimeView",boxSizing:"border-box",dateFormat:"yyyy-MM-dd",timeFormat:"hh:mm:ss"},"private":{picker:null,timer:null},extend:{render:function(){var t=this;t.initEvents(),t.initTimer(),t.update()},height:function(t){var e=this;e[0].lineHeight(isNumber(t)?t:e.height())},remove:function(){var t=this;t._timer&&clearInterval(t._timer)}},"protected":{initEvents:function(){var t=this;t.opts},initTimer:function(){var t=this;return t._timer=setInterval(function(){t.update()},1e3),t},update:function(){var t=this,e=t.D;return e.date&&e.date.html((new Date).format(t.dateFormat())),e.time&&e.time.html((new Date).format(t.timeFormat())),t}},"public":{fontSize:function(t){return this.opt("fontSize",t,function(){this[0].css("fontSize",t+"px")})},dateFormat:function(t){return this.opt("dateFormat",t,function(){this.renderState&&this.update()})},timeFormat:function(t){return this.opt("timeFormat",t,function(){this.renderState&&this.update()})},type:function(t){var e=this;return e.opt("type",t,function(){e[0].clear(),"dateTime"===t?e[0].append([e.D.date=newDiv("_date"),e.D.time=newDiv("_time")]):"date"===t?e[0].append(e.D.date=newDiv("_date")):"time"===t&&e[0].append(e.D.time=newDiv("_time")),e.renderState&&e.update()
})}},main:function(t){t.D={},t.call_opts({type:"",fontSize:13},!0)}}),Std.ui.module("SpinBox",{parent:"LineEdit",option:{min:"infinite",max:"infinite",minWidth:32,minHeight:12,defaultClass:"StdUI_SpinBox",validator:"Number"},extend:{initEvents:function(){var t=this,e=t.opts;t.D.input.on({keydown:function(t){var e=t.which,n=t.keyCode,i=this.value();switch(!0){case 190===n&&!i.has("."):isEmpty(i)&&this.value("0");break;case n>36&&41>n:case 173===e&&0===i.length:case 8===n||13===n:case e>47&&58>e:"0"==i&&this.value("");break;case 9===n:break;default:t.preventDefault()}},keyup:function(){var n=this.value();"infinite"!==e.min&&n<e.min?t.value(e.min):"infinite"!==e.max&&n>e.max&&t.value(e.max)}})}},"protected":{initHandle:function(){var t=this,e=function(){t.value(~~t.value()+1).select()},n=function(){t.value(~~t.value()-1).select()};return t[0].append(t.D.handles=newDiv("_handles").append([t.D.add=newDiv("_handle _add").mouse({down:e,longpress:e}),t.D.subtract=newDiv("_handle _subtract").mouse({down:n,longpress:n})]).on("mousedown",function(t){t.preventDefault()})),t}},"public":{value:function(t){var e=this,i=e.opts,o=e.D;return t===n?float(o.input.value()):(isNumber(t)||(t=float(t)),"infinite"!==i.min&&t<i.min&&(t=i.min),"infinite"!==i.max&&t>i.max&&(t=i.max),e.placeHolderState(""===t),o.input.value(t+""),e)}},main:function(t){t.initHandle()}}),Std.ui.module("FieldSet",{nodeName:"fieldset",parent:"widget",option:{level:1,defaultClass:"StdUI_FieldSet",boxSizing:"border-box",layout:"VBoxLayout",items:null,spacing:5,width:300,height:150,tabIndex:null,title:"FieldSet"},action:{children:"append"},extend:{render:function(){var t=this;t._layout.render().update()},remove:function(t){var e=this;e._layout&&e._layout.remove(t)},width:function(){var t=this;t.D.client.width(t.width()-t.boxSize.width)}},"protected":{initLayout:function(){var t=this;return t._layout=Std.ui(t.opts.layout,{parent:t.D.client,spacing:t.spacing()}),t},initElements:function(){var t=this,e=t.D={legend:newDom("legend","_title"),client:newDiv("_client")};return t[0].append([e.legend.html(t.title()),e.client]),t}},"public":{refreshLevel:function(){var t=this;return t.level(t._layout),t},title:function(t){return this.opt("title",t,function(){this.D.label.html(t)})},spacing:function(t){return this.opt("spacing",t,function(){this[0].padding(t)})},update:function(){var t=this;return t._layout.update(),t},insert:function(t,e){var n=this;return n._layout.insert(t,e),n.refreshLevel(),n.renderState&&n.update(),n},append:function(t){var e=this;return e._layout.append(t),e.refreshLevel(),e.renderState&&e.update(),e},clear:function(){var t=this;return t._layout.clear(),t}},main:function(t,e){t.initElements(),t.initLayout(),t.call_opts("spacing"),e.items&&t.append(e.items)}}),Std.ui.module("ListItem",{parent:"Item",option:{defaultClass:"StdUI_Item StdUI_ListItem",iconHeight:16,iconWidth:16,height:24,value:null},"private":{selected:!1},extend:{height:function(t){var e=this,n=e.opts,i=e.D;isNumber(t)||(t=e.height()),i.icon&&i.icon.marginTop(Math.floor((t-n.iconHeight)/2)),e[0].lineHeight(t-e.boxSize.height)}}}),Std.ui.module("List",{parent:"widget",events:"itemClick itemRename select",action:{children:"append"},option:{defaultClass:"StdUI_List",level:4,type:"default",value:null,items:null,editable:!1,template:null,dataSource:null,itemHeight:24,itemWidth:80,iconWidth:16,iconHeight:16,selectionMode:"single"},"private":{selectedItems:null},extend:{render:function(){var t=this;t.items.each(function(e,n){n.renderTo(t[0])})},remove:Std.func(function(t){var e=this,n=e.items,i=e.selectedItems;if(isObject(t)){var o=n.indexOf(t);-1!==o&&(t=o)}isNumber(t)&&t<n.length&&(i.has(t)&&e.clearSelected(t),n[t].remove(),n.remove(n))},{each:[isArray]})},"protected":{initEvents:function(){var t=this;return t[0].focussing(function(){t.addClass("focus")},function(){t.removeClass("focus")},!1),t},initItemEvents:function(){var t=this,e=t.opts.selectionMode,n=function(n,i,o){"multi"===e?(o.ctrlKey||t.clearSelect(),i._selected?t.clearSelect(i):t.select(i)):"none"!==e&&(t.clearSelect(),t.select(n))};return t[0].delegate("mouseenter",".StdUI_ListItem,.StdUI_TemplateItem",function(e){var i=this.index(),o=t.items[i];o[0].mouse({auto:!1,dblclick:function(){t.editable()&&t.editItem(o)},click:function(){t.emit("itemClick",o)},down:function(t){n(i,o,t)}},e)}),t},editItem:function(t){var e=this;return t instanceof Std.ui("ListItem")&&t.edit(function(n,i){e.emit("itemRename",[t,n,i],!0)}),e},createItem:function(t){var e=this,n=e.opts,i="ListItem",o={height:n.itemHeight,iconWidth:n.iconWidth,iconHeight:n.iconHeight};return isWidget(t)?t:(n.template?(i="TemplateItem",Std.extend(o,{data:t,template:e.template(),textField:n.textField,valueField:n.valueField})):isString(t)||isNumber(t)?o.text=t:isObject(t)&&(isString(t.ui)&&(i=t.ui),o=Std.extend(o,t)),null!==o?("block"==n.type&&(o.width=n.itemWidth),Std.ui(i,o)):null)}},"public":{type:function(t){return this.opt("type",t,function(){this[0].toggleClass("_block","block"===t)})},itemWidth:function(t){return this.opt("itemWidth",t,function(){Std.each(this.items,function(e,n){n.width(t)})})},itemHeight:function(t){return this.opt("itemHeight",t,function(){Std.each(this.items,function(e,n){n.height(t)})})},dataSource:function(t){return this.opt("dataSource",t,function(){this.reload()})},editable:function(t){return this.opt("editable",t)},each:function(t,e){var n=this;return Std.each(n.items,function(e,i){return isFunction(t)?t.call(n,e,i):void 0},e)},template:function(t){var e=this,i=e.opts;return t===n?i.template:(isString(t)&&(t=Std.template(t)),t instanceof Std.template&&(i.template=t),e)},reload:function(t){var e=this,n=e.opts,i=n.dataSource,o=i.read;return i&&"ajax"===i.type&&isObject(o)&&Std.ajax.json({url:o.url,data:Std.extend(o.data||{},t),type:o.type||"get",success:function(t){e.clear(),e.append(Std.mold.dataPath(t,o.dataPath)),e.emit("dataSourceLoad",t)}}),e},select:Std.func(function(t){var e=this,n=e.opts,i=e.items,o=n.selectionMode;if("none"!==o)if(isWidget(t))e.select(i.indexOf(t));else if(isNumber(t)&&-1!==t){var r=i[t];if(!r||r._selected)return;"single"===o&&e.clearSelect(),r.addClass("selected"),r._selected=!0,e.selectedItems.push(r),e.emit("select",[t,r],!0)}},{each:[isArray]}),insert:function(t,e){var n=this,i=n.createItem(t);null!==i&&isWidget(i)&&(n.items.insert(i,e),n[0].insert(i[0],e),n.renderState&&i.render())},append:Std.func(function(t){this.insert(t)},{each:[isArray]}),clearSelect:function(t){var e=this,i=e.selectedItems;if(t===n){for(var o=0,r=i.length;r>o;o++)i[o].removeClass("selected"),i[o]._selected=!1;i.clear()}else if(isNumber(t)&&-1!==t){var a=i[t];a&&a._selected&&(a.removeClass("selected"),a._selected=!1,i.remove(t))}else isWidget(t)&&e.clearSelect(i.indexOf(t));return e},clear:function(){for(var t=this,e=t.items,n=0,i=e.length;i>n;n++)e[n].remove();return e.clear(),t.selectedItems.clear(),t}},main:function(t,e){t.items=[],t.selectedItems=[],t.call_opts({type:"default",template:null},!0),e.items&&t.append(e.items),t.initEvents(),t.initItemEvents()}}),Std.ui.module("MenuItem",{parent:"Item",action:{content:"text",children:"append"},option:{defaultClass:"StdUI_MenuItem",text:"menu item",items:null,root:null},"private":{childVisible:!1},extend:{render:function(){var t=this,e=t.opts;null!==e.items&&(t.D.open=newDiv("_open").appendTo(t[0]))},remove:function(t){var e=this;e.menu&&e.menu.remove(t),e.items&&e.items.clear()}},"public":{root:function(t){var e=this,i=e.opts;return t===n?i.root||e:(i.root=t,e)},insert:function(t,e){var n=this,i=n.D;return n.menu?n.menu.insert(t,e):(n.items||(n.items=[]),n.items.insert(t,e)),i.open||(i.open=newDiv("_open").appendTo(n[0])),n},append:Std.func(function(t){return this.insert(t)},{each:[isArray]}),showChild:function(){var t=this,e=t[0].offset();return t._childVisible?t:(t.menu||(t.menu=Std.ui("Menu",{parent:t,items:t.items,root:t.root(),renderTo:"body"})),t.menu.visible(t._childVisible=!0).toForeground(),t.menu[0].css({position:"absolute",left:e.x+t.width(),top:e.y,margin:0}),t)},hideChild:function(t){var e=this;return e.menu?(t===!1?e.menu.visible(e._childVisible=!1):e.menu[0].animate("end").animate({to:{opacity:0}},100,function(){e.menu.visible(e._childVisible=!1)}),e):e},childVisible:function(t){var e=this;return t===n?e._childVisible:t===e._childVisible?e:(e._childVisible===!0?e.showChild():e.hideChild(),e)}},main:function(t,e,n){var i=t.D;e.items&&(t.items=e.items),i.icon||t.initIcon(),i.text||n.append(i.text=newDiv("_text"))}}),Std.ui.module("Menu",{parent:"widget",events:"itemPress",option:{defaultClass:"StdUI_Menu",level:1,width:"auto",height:"auto",items:null,root:null},"private":{currentItem:null},extend:{render:function(){var t=this;t.items.each(function(t,e){e.render()})},visible:function(t){var e=this;t===!0?e[0].css("zIndex",++Std.ui.status.zIndex):(e.select(!1),e.items.each(function(t,e){e._childVisible&&e.hideChild()}))},remove:function(t){var e=this,i=e.items;if(t===n)i.each(function(t,e){e.remove()});else if(isNumber(t))i[t]&&i[t].remove()&&i.remove(t);else if(isWidget(t)){var o=i.indexOf(t);-1!==o&&i[o]&&i[o].remove()&&i.remove(o)}}},"protected":{keyEvent:function(t,e,n){var i=this,o=0,r=i.items,a=i.parent(),s=function(t){return!t.enable()||"MenuItem"!==t.ui};if(13===t)i.root().emit("itemPress",e.emit("press"));else if(27===t)isWidget(a)&&(i.hide(),"MenuItem"===a.ui?a.parent().focus():a.focus());else{if(37===t)return e.hideChild(),a&&"MenuItem"===a.ui&&(a.focus().hideChild(),a.parent().focus()),!1;if(38===t)return function(t){++o>r.length||(t=--t<0?r.length-1:t,s(r[t])?arguments.callee(t):i.select(t))}(n),!1;if(39===t)return e.menu&&(e.showChild(),e.menu.focus().select(0)),!1;if(40===t)return function(t){++o>r.length||(t=++t>=r.length?0:t,s(r[t])?arguments.callee(t):i.select(t))}(n),!1}},initKeyboard:function(){var t=this;return t[0].on({contextmenu:Std.func(!1),keydown:function(e){var n=t._currentItem,i=t.items.indexOf(n);return-1!=i?t.keyEvent(e.keyCode,n,i):void 0}}),t},initEvents:function(){var t=this,e=!1;return t[0].delegate("mouseenter mouseleave mousedown click",".StdUI_MenuItem",function(n){var i=t.items[this.index()],o=n.name;e===!1&&t[0].unselect(e=!0),i.enable()&&"sep"!==i.ui&&("click"===o?t.root().emit("itemPress",i.emit("press")):"mousedown"===o?n.stopPropagation():"mouseenter"==o?t.select(i):"mouseleave"!=o||i.childVisible()||t.select(!1))}),t},createItem:function(t){var e=null,n=this.root();return isString(t)?e=Std.ui("MenuItem",{text:t,root:n}):isWidget(t)?e=t:isObject(t)&&(t.root=n,e=Std.ui(t.ui||"MenuItem",t)),e}},"public":{each:function(t){return Std.each(this.items,t)},root:function(t){var e=this,i=e.opts;return t===n?i.root||e:(i.root=t,e)},select:function(t){var e=this;return t===e._currentItem?e:(e._currentItem&&(e._currentItem.removeClass("selected").hideChild(!1),e._currentItem=null),t===!1?e:(isNumber(t)&&(t=e.items[t]),isWidget(t)&&"MenuItem"===t.ui&&t.enable()?((e._currentItem=t.addClass("selected")).D.open&&t.showChild(),e):e))},insert:function(t,e){var n=this,i=n.createItem(t);return isWidget(i)&&(n[0].insert(i[0],e),n.renderState&&i.render(),n.items.insert(i.parent(n),e)),n},append:Std.func(function(t){this.insert(t)},{each:[isArray]})},main:function(t,e){t.items=[],null!=e.items&&t.append(e.items),t.initEvents(),t.initKeyboard()}}),Std.ui.module("MenuBar",{parent:"widget",action:{children:"append"},option:{defaultClass:"StdUI_MenuBar",level:3,height:24,minHeight:16,items:null},"private":{state:0,selectedIndex:-1},extend:{render:function(){},height:function(){var t=this;t[1].lineHeight(t.height())},remove:function(t){var i=this;if(t===n)Std.dom(e).off({keydown:i._keydown,keyup:i._keyup,mousedown:i._mousedown}),Std.each(i.items,function(t,e){e.menu&&e.menu.remove()});else if(isNumber(t)){var o=i.items[t];o.menu&&o.menu.remove(),o.elem.remove(),i.items.remove(t)}}},"protected":{keyEvent:function(t){var e=this,n=e.items.length,i=e._selectedIndex;switch(t.keyCode){case 37:0>=i&&(i=n),e.select(i-1);break;case 39:i>=n-1&&(i=-1),e.select(i+1);break;case 40:var o=e.items[i],r=o.menu.focus();null==r._currentItem&&r.select(0)}},initKeyboard:function(){var t=this,n=!1,i=Std.dom(e);return i.on("mousedown",t._mousedown=function(e){var n=e.target;(t[1].is(n)||!t[1].contains(n))&&t.clearStates()}),i.on("keyup",t._keyup=function(){n===!0&&(t.updateLabels(),n=!1)}),i.on("keydown",t._keydown=function(e){var i=Std.dom(e.target),o=t[0].offsetParent();o&&(i.is(o)||o.contains(i))&&t[0].visible()&&(18===e.keyCode?(t.updateLabels(n=!0),e.preventDefault()):27===e.keyCode?t.clearStates():e.altKey&&(Std.each(t.items,function(n,i){return-1!==i.text.toUpperCase().indexOf("&"+String.fromCharCode(e.keyCode))?(n===t._selectedIndex?t.clearStates():t.select(n),t.focus(),!0):void 0}),e.preventDefault()))}),t[0].on("keydown",function(e){t.keyEvent(e)}),t},initEvents:function(){var t=this;return t[0].on("mouseenter","._item",function(e){var n=this.index();this.mouse({auto:!1,click:function(){n!==t._selectedIndex?t.select(n):t.clearStates()}},e),1==t._state&&t.select(n)}),t.initKeyboard()},showMenu:function(){var t=this,e=t.currentSelected();if(e){var n=e.elem.offset(),i=e.menu;i.show()[0].css({left:n.x,top:n.y+t.height()})}return t},createItem:function(t){var e=this,n=newDiv("_item").appendTo(e[1]),i=null,o=null;return(isString(t.icon)||isString(t.iconClass))&&(i=newDiv(t.iconClass||"").appendTo(n)),isString(t.icon)&&i.append(newDom("img").src(t.icon)),isString(t.text)&&(o=newDiv("_text").html(t.text.replace("&","")).appendTo(n)),{elem:n,iconElem:i,textElem:o,name:t.name,text:t.text,items:t.items}},formatLabel:function(t){var e=t.indexOf("&"),n="";if(-1==e)return t;for(var i=0,o=t.length;o>i;i++){var r=t.charAt(i);n+="&"===r&&o>i+1?"<span style='text-decoration: underline'>"+t.charAt(++i)+"</span>":r}return n},updateLabels:function(t){var e=this;return Std.each(e.items,function(n,i){var o="";o=t===!0?e.formatLabel(i.text):i.text.replace(/&/,""),i.textElem.html(o)}),e},clearStates:function(){var t=this,e=t.currentSelected();return e&&null!==e.menu&&(e.elem.removeClass("selected"),e.menu.hide(),t._selectedIndex=-1,t._state=0),t},currentSelected:function(){var t=this;return-1===t._selectedIndex?null:t.items[t._selectedIndex]}},"public":{select:function(t){var e=this,n=e.items[t];return null==n?e:(n.menu||(n.menu=Std.ui("Menu",{parent:e,renderTo:"body",items:n.items,css:{position:"absolute"},on:{itemPress:function(){e.clearStates()}}})),e.clearStates(),n.elem.addClass("selected"),e._state=1,e._selectedIndex=t,e.showMenu())},append:Std.func(function(t){var e=this;e.items.push(e.createItem(t))},{each:[isArray]})},main:function(t,e,n){t.items=[],t.initEvents(),n.append(t[1]=newDiv("_items")),e.items&&t.append(e.items)}}),Std.ui.module("ComboBoxItem",{parent:"Item",option:{defaultClass:"StdUI_ComboBoxItem"}}),Std.ui.module("ComboBox",{parent:"widget",option:{level:3,defaultClass:"StdUI_ComboBox",boxSizing:"border-box",minWidth:40,minHeight:26,maxHeight:26,listMaxHeight:300,height:26,items:null,value:null,template:null,inputMode:"none",valueMode:"text",textField:"text",valueField:"value",dataSource:null,suggest:!1},events:"open close select change focus blur dataSourceLoad",action:{children:"append",childNodes:function(t,e){var n=[];Std.each(e,function(t,e){var i={},o=e.html(),r=e.attr("icon"),a=e.attr("std-option");isString(o)&&(i.text=o),isString(r)&&(i.icon=r),isString(a)&&Std.extend(i,a.toObject()),n.push(i)}),this.append(n)}},"private":{listVisible:!1,currentMode:"",currentItem:null,selectedItem:null},extend:{render:function(){var t=this;t.initEvents(),t.call_opts({value:null},!0)},remove:function(t){t===n&&(this.D.list&&this.D.list.remove(),this.delDocumentEvents())},height:function(t){var e=this,n=e.D;t=e.height()-e.boxSize.height,n.input&&n.input.css({height:t,lineHeight:t}),n.content&&n.content.css({height:t,lineHeight:t})},width:function(t){var e=this,n=e.D;t=e.width()-e.boxSize.width,n.input&&n.input.css({width:t-24}),n.content&&n.content.css({width:t-24})}},"protected":{createItem:function(t){var e=this,n=e.opts,i=null;return isString(t)?i=Std.ui("ComboBoxItem",{text:t}):isWidget(t)?i=t:isObject(t)&&(i=n.template?Std.ui("TemplateItem",{template:e.template(),data:t,textField:n.textField,valueField:n.valueField}):Std.ui(t.ui||"ComboBoxItem",t)),i},toggleList:function(){var t=this;if(t.enable())return 1==t._listVisible?t.close():t.open(),t},itemMouseEnter:function(t,e){var n=this,i=t.index(),o=n.items[i];return t.mouse({auto:!1,classStatus:!1,enter:function(){n._selectedItem&&n._selectedItem.removeClass("selected"),n._selectedItem=o.addClass("selected")},click:function(){n.value(o),n.toggleList(),n.focus()}},e),n},addDocumentEvents:function(){var t=this,n=t.D;return Std.dom(e).on("mousedown",t._documentEvents||(t._documentEvents=function(e){n.list&&n.list.contains(e.target)||t.delDocumentEvents().close()})),t},delDocumentEvents:function(){var t=this;return t._documentEvents&&Std.dom(e).off("mousedown",t._documentEvents),t},initHandle:function(){var t=this,e=t.D;return e.handle!=n?t:(e.handle=newDiv("_handle").appendTo(t[0]),t)},initKeyboard:function(){var t=this;return t.on("keydown",function(e){var n=t.items,i=n.indexOf(t._currentItem),o=e.which,r=e.keyCode;27===o?t.close():32===o&&"none"===t.inputMode()&&t.open(),-1!=i&&(38===r?(t.value(--i<0?n[n.length-1]:n[i]),t.focus()):40===r&&(t.value(++i>=n.length?n[0]:n[i]),t.focus()),"INPUT"===e.target.nodeName&&t.opts.suggest)}),t},initEvents:function(){var t=this,e=!1;return t[0].on({mousedown:function(e){1===e.which&&"INPUT"!==e.target.nodeName&&t.toggleList()},focusin:function(n){t.addClass("focus").emit("focus",n),e===!1&&(t.initKeyboard().on("focusout",function(e){t.emit("blur",e)[0].removeClass("focus")}),t.D.input&&t.D.input.on("change",function(){t.emit("change")}),e=!0)}}).mouse({unselect:!0}),t},initList:function(){var t=this,e=t.D;return e.list!==n?t:(e.list=newDiv("StdUI StdUI_ComboBoxList").appendTo("body").on("mousedown",function(t){t.preventDefault()}).delegate("mouseenter",".StdUI_ComboBoxItem,.StdUI_TemplateItem",function(e){t.itemMouseEnter(this,e)}),t.items.each(function(t,n){n.renderTo(e.list)}),t)}},"public":{textField:function(t){return this.opt("textField",t)},valueField:function(t){return this.opt("valueField",t)},valueMode:function(t){return this.opt("valueMode",t)},dataSource:function(t){var e=this;return e.opt("dataSource",t,function(){e.reload()})},text:function(t){var e=this,i=e.D;return t===n?i.content.text():(i.content.text(t),e)},select:function(t){var e=this;return isNumber(t)&&(t=e.items[t]),isWidget(t)&&e._currentItem!==t&&(e._currentItem&&e._currentItem.removeClass("selected"),e._currentItem=e._selectedItem=t.addClass("selected"),e.emit("select change",t)),e},template:function(t){var e=this,i=e.opts;return t===n?i.template:(isString(t)&&(t=Std.template(t)),t instanceof Std.template&&(i.template=t),e)},value:function(t){var e=this,i=e[e.opts.valueMode+"Value"];return e.D.list||e.initList(),isFunction(i)?i.call(e,t):t===n?null:e},reload:function(){var t=this,e=t.dataSource(),n=e.read;"ajax"===e.type&&isObject(n)&&Std.ajax.json({url:n.url,data:n.data,type:n.type}).on("success",function(e){t.clear(),t.append(Std.mold.dataPath(e,n.dataPath)),t.call_opts("value",!0),t.emit("dataSourceLoad",e)})},inputMode:function(t){var e=this,n=e.D;return e.opt("inputMode",t,function(){n.input&&n.input.remove(),n.content&&n.content.remove(),""!==e._currentMode&&e.removeClass("_"+e._currentMode),"input"===t?n.input=newDom("input","_input").appendTo(e[0]):"none"===t&&(n.content=newDiv("_content").appendTo(e[0])),e.addClass("_"+(e._currentMode=t))})},textValue:function(t){var e=this,i=e.D,o=t,r=e.inputMode();if("input"===r){if(t===n)return i.input.value();isWidget(t)&&(o=t.text()),i.input&&i.input.value(o)}else if("none"===r){if(t===n)return e.text();isWidget(t)&&(o="TemplateItem"===t.ui?t.text():t[0].clone().className(t.opts.defaultClass)),i.content&&i.content.html(o)}return e.select(t)},indexValue:function(t){var e=this,i=e.D,o=null,r=e.items,a=t,s=e.inputMode();if(t===n)return e._currentItem?r.indexOf(e._currentItem):null;if(isWidget(t)){if(-1===(a=r.indexOf(t)))return e}else isString(a)&&(a=int(a));return(o=r[a])?("input"===s?i.input&&i.input.value(o.text()):"none"===s&&i.content&&i.content.html("TemplateItem"===o.ui?o.text():o[0].clone().className(o.opts.defaultClass)),e.select(a)):e},itemValue:function(t){var e=this,i=e.D,o=null,r=e.items,a=-1,s=e.inputMode();if(t===n)return e._currentItem?e._currentItem.value():null;if(isWidget(t)){if(-1===(a=r.indexOf(t)))return e;o=t}return-1==a&&e.items.each(function(e,n){return n.value()==t?(o=n,a=e,!1):void 0}),null===o?e.select(a):("input"===s?i.input&&i.input.value(o.text()):"none"===s&&i.content&&i.content.html("TemplateItem"===o.ui?o.text():o[0].clone().className(o.opts.defaultClass)),e.select(a))},open:function(){var e=this,n=e.D,i=e[0].offset(),o=0;if(e._listVisible)return e;n.list||e.initList(),n.list.show(),n.handle.addClass("_open"),(o=n.list.offsetHeight())>e.opts.listMaxHeight&&(o=e.opts.listMaxHeight);var r=i.y+e.height(),a={height:o-n.list.boxSize().height,opacity:1};return i.y+e.height()+o>Std.dom(t).height()&&(n.list.addClass("_top"),a.top=(r=i.y)-o),n.list.css({left:i.x,top:r,width:e[0].width()-2,height:0,opacity:0,overflow:"hidden"}).animate("end").animate({100:a},{duration:150,timingFunction:"ease-in"},function(){e.addDocumentEvents(),n.list.removeStyle("overflow")}),setTimeout(function(){n.list.css("zIndex",++Std.ui.status.zIndex)},5),e._listVisible=!0,e.emit("open")},close:function(){var t=this,e=t.D,n=t[0].offset(),i={height:0,opacity:0};return t._listVisible?(n.y>e.list.css("top")&&(i.top=n.y),e.handle.removeClass("_open"),e.list&&e.list.css("overflow","hidden").animate("end").animate({100:i},140,function(){e.list.hide().removeStyle("overflow height").removeClass("_top"),null!==t._selectedItem&&t._selectedItem.removeClass("selected"),null!==t._currentItem&&(t._selectedItem=t._currentItem.addClass("selected"))}),t.delDocumentEvents(),t._listVisible=!1,t.emit("close")):t},insert:function(t,e){var n=this,i=n.createItem(t);if(isWidget(i)){var o=n.items,r=n.D.list;r&&(e<o.length?r.insertBefore(i,o[e]):r.append(i),i.render()),o.insert(i.parent(n),e)}return n},append:Std.func(function(t){var e=this,n=e.createItem(t);isWidget(n)&&(e.D.list&&n.renderTo(e.D.list),e.items.push(n.parent(e)))},{each:[isArray]}),clear:function(){var t=this,e=t.items;return Std.each(e,function(t,e){e.remove()}),e.clear(),t}},main:function(t,e){t.D={},t.items=[],t.inputMode(e.inputMode),t.initHandle(),t.call_opts("dataSource",!0),null!==e.template&&t.template(e.template),null!==e.items&&t.append(e.items)}}),Std.ui.module("ToolTip",{parent:"widget",option:{level:2,defaultClass:"StdUI_ToolTip",value:null,renderTo:"body",align:"center",position:"top",x:0,y:0,iframe:null,html:null,url:null,selector:null,target:null,tabIndex:null,padding:12},extend:{visible:function(t){t===!0&&this[0].css("zIndex",Std.ui.status.zIndex+1)},render:function(){this.initEvents(),this.call_opts({selector:null},!0),this[0].css("zIndex",Std.ui.status.zIndex+1)}},"protected":{height:function(t){this[1].outerHeight(t)},width:function(t){this[1].outerWidth(t)},initEvents:function(){var t=this;return t.on("load",t.relocate),t},computeXY:function(t,e,n,i){var o=this,r=Std.dom(o.target()),a=o.position();if(null==r)return{x:0,y:0};var s=0,l=0,u=r.offsetHeight(),c=r.offsetWidth(),d=r.offset();return"top"==a?(s=d.x+(c-t)/2,l=d.y-(e+i)):"bottom"==a?(s=d.x+(c-t)/2,l=d.y+u+i):"right"==a?(s=d.x+c+n,l=d.y+(u-e)/2):"left"==a&&(s=d.x-n-t,l=d.y+(u-e)/2),{x:s,y:l}},relocate:function(){var t=this,e=t.position(),n=t[1].offsetWidth(),i=t[1].offsetHeight(),o=t[2].offsetWidth(),r=t[2].offsetHeight();switch(e){case"top":case"bottom":t[2].css("left",(n-o)/2);break;case"right":case"left":t[2].css("top",(i-r)/2)}if(t.target()){var a=t.computeXY(n,i,o,r);t.move(a.x,a.y)}return t}},"public":{target:function(t){return this.opt("target",t)},x:function(t){return this.opt("x",t,function(){this[0].css("left",t)})},y:function(t){return this.opt("y",t,function(){this[0].css("top",t)})},align:function(t){return this.opt("align",t,function(){this.renderState&&this.relocate()})},position:function(t){var e=this;return e.opt("position",t,function(){e[2].className("_pointer _"+t),e.renderState&&e.relocate()})},padding:function(t){var e=this;return this.opt("padding",t,function(){e[1]&&e[1].css("padding",t),e.renderState&&e.relocate()})},selector:function(t){var e=this;return this.opt("selector",t,function(){var n=Std.dom(t);if(null!==n){var i=n.html();e[1].html(i),e.emit("load",i)}})},iframe:function(t){var e=this;return e.opt("iframe",t,function(){e[1].clear().append(newDom("iframe").attr({src:t,frameBorder:0}).on("load",function(){e.emit("load")})),e.relocate()})},html:function(t){var e=this;return e.opt("html",t,function(){e[1].html(t),e.emit("load",t)})},url:function(t){var e=this;return e.opt("url",t,function(){var n=newDiv("_loading");e[1].append(n),n.css("marginTop",(e[1].height()-n.height())/2),e.relocate(),Std.ajax({url:t,cache:!0,success:function(t){e.html(t)}})})}},main:function(t){t[0].append([t[1]=newDiv("_client"),t[2]=newDiv("_pointer")]),t.call_opts(["x","y","padding","position"])}}),Std.plugin.module("ToolTip",{option:{triggerMode:"mouseenter",timeout:200,delegate:null,width:"auto",height:"auto",position:"top"},"protected":{createWidget:function(){var t=this,e=t.opts,n={on:{load:function(e){t.emit("load",e)}}};return Std.each("className position width height padding renderTo url html iframe selector",function(t,i){i in e&&(n[i]=e[i])}),t._tooltip=Std.ui("ToolTip",n),t},initToolTip:function(){var t=this;return t._tooltip||t.createWidget(),t},removeToolTip:function(){var t=this,e=t._tooltip;return e&&e.remove(),t._tooltip=null,t},remove:function(){var t=this;return null!==t._timer&&(clearTimeout(t._timer),t._timer=null),t.removeToolTip(),t}},"public":{iframe:function(t){return this.opt("iframe",t,function(){this._tooltip&&this._tooltip.iframe(t)})},html:function(t){return this.opt("html",t,function(){this._tooltip&&this._tooltip.html(t)})},url:function(t){return this.opt("url",t,function(){this._tooltip&&this._tooltip.url(t)})},selector:function(t){return this.opt("selector",t,function(){this._tooltip&&this._tooltip.selector(t)})},target:function(t){var e=this,i=e._tooltip;return t===n?i.target():(i.target(t),e)},clearTimer:function(){var t=this;return null!==t._timer&&(clearTimeout(t._timer),t._timer=null),t}},main:function(t,e,n){t._timer=null;var i=function(n){var i=this;this.mouse({auto:!1,enter:function(){t.clearTimer(),t._timer=setTimeout(function(){t._tooltip||t.initToolTip(),t.target(i).emit("render",i),t._tooltip.relocate()},e.timeout)},leave:function(){t.clearTimer().removeToolTip()}},n)};isString(e.delegate)?Std.dom(n).on(e.triggerMode,e.delegate,i):Std.dom(n).on(e.triggerMode,i)}}),Std.ui.module("ToolBar",{parent:"widget",action:{children:"append"},option:{level:3,height:30,minHeight:28,items:null,styleType:"textBesideIcon",defaultClass:"StdUI_ToolBar"},extend:{render:function(){var t=this;t.items.each(function(t,e){e.render()})},height:function(t){var e=this;e.items.each(function(n,i){i.height(t-e.boxSize.height)})},remove:function(t){var e=this,i=e.items;if(t===n)e.clear();else if(isNumber(t))i[t].remove(),i.remove(t);else if(isWidget(t)){var o=i.indexOf(t);-1!==o&&(i[o].remove(),i.remove(o))}}},"protected":{createTool:function(t){var e=this,n=e.opts,i=null;return isWidget(t)?i=t:isString(t)?i=Std.ui("ToolButton",{text:t,styleType:n.styleType}):isObject(t)&&(t.styleType=n.styleType,i=Std.ui(t.ui||"ToolButton",t)),isWidget(i)&&i.parent(e),i}},"public":{append:Std.func(function(t){var e=this,n=e.createTool(t);null!==n&&(n.appendTo(e.D.buttons),e.renderState&&n.render(),e.items.push(n))},{each:[isArray]}),insert:function(t,e){var n=this,i=n.items.length;if(i>e){var o=n.createTool(t);null!==o&&(n.D.buttons.insertBefore(o,n.items[e]),n.items.insert(o,e))}else e===i&&n.append(t);return n},clear:function(){for(var t=this,e=t.items,n=0,i=e.length;i>n;n++)e[n].remove();return e.clear(),t}},main:function(t,e,n){t.D={buttons:newDiv("_buttons").appendTo(n)},t.items=[],e.items&&t.append(e.items)}}),Std.ui.module("Panel",{parent:"widget",events:"titleButtonClick",option:{defaultClass:"StdUI_Panel",level:4,width:300,height:200,minWidth:70,minHeight:50,title:"panel",menuBar:null,toolBar:null,titleIcon:null,titleIconClass:null,titleHeight:22,titleButtons:null,clientPadding:8,collapsible:!1,collapsed:!1},action:{content:"html",children:"append"},"private":{titleBar:null,menuBar:null,toolBar:null,client:null,central:null,titleButtons:null},extend:{render:function(){var t=this;t._menuBar&&t._menuBar.render(),t._toolBar&&t._toolBar.render(),t._central.render(),t.initEvents(),t.call_opts("collapsed",!0)},height:function(t){var e=this;e.updateHeight(t),e._central.emit("resize")},remove:function(){var t=this;t._central.remove(),t._menuBar&&t._menuBar.remove(),t._toolBar&&t._toolBar.remove()}},"protected":{titleButtonClick:function(t){var e=this,n=e.opts;return"collapse"===t&&e.collapsed(!n.collapsed,!0),e.emit("titleButtonClick",[t,e],!0)},initEvents:function(){var t=this,e=t.D,n=!1;return t[0].on({focusin:function(){t.addClass("focused")},focusout:function(){t.removeClass("focused")},mousedown:function(){t.focus()},mouseenter:function(){0==n&&(e.TitleBar.unselect(n=!0),t._toolBar&&t._toolBar[0].unselect(!0))}}),t},initTitleEvents:function(){var t=this,e=t.D;return e.TitleBar.on("mouseenter","._buttons > ._button",function(e){this.mouse({auto:!1,down:function(t){t.stopPropagation()},click:function(){var e=t._titleButtons;for(var n in e)e[n].contains(this)&&t.titleButtonClick(n)}},e)}),t},initTitle:function(){var t=this,e=t.opts,n=t.D;return n.TitleBar=newDiv("_title").outerHeight(e.titleHeight).append([n.TitleIcon=newDiv("_icon"),n.TitleText=newDiv("_text").html(e.title),n.TitleButtons=newDiv("_buttons")]).appendTo(t[0]),t},initBody:function(){var t=this;return t[0].append(t.D.body=newDiv("_body")),t},initClient:function(){var t=this,e=t.opts;return t.D.Client=newDiv("_client").append(t._central=Std.ui("widget",{defaultClass:"_central",appendTo:t[0],tabIndex:null})).appendTo(t.D.body),e.clientPadding&&t.D.Client.padding(e.clientPadding),t},updateHeight:function(t){var e=this,n=e.opts,i=(isNumber(t)?t:e.height())-e.boxSize.height-n.titleHeight;return n.clientPadding&&(i-=2*n.clientPadding),e._toolBar&&(i-=e._toolBar.height()),e._menuBar&&(i-=e._menuBar.height()),e.D.Client.height(i),e},createTitleButton:function(t,e){var n=this._titleButtons[t]=Std.is.DOM(e)?e:newDiv("_button").data(t,e);return isPlainObject(e)?n.set(e):isString(e)&&n.addClass(e),n}},"public":{title:function(t){return this.opt("title",t,function(){this.titleText(t)})},collapsible:function(t){var e=this;return e.opt("collapsible",t,function(){t===!0&&e.appendTitleButton("collapse","_collapse")})},clientPadding:function(t){return this.opt("clientPadding",t,function(){this.D.Client&&this.D.Client.padding(t)})},titleText:function(t){var e=this;return e.opt("text",t,function(){e.D.TitleText.html(t)})},titleIcon:function(t){var e=this,n=e.D;return e.opt("titleIcon",t,function(){n.TitleIconImg||(n.TitleIconImg=newDom("img").appendTo(n.TitleIcon)),n.TitleIconImg.attr("src",t)})},titleIconClass:function(t){var e=this,n=e.D;return e.opt("titleIcon",t,function(){n.TitleIcon.className("_icon "+t)})},url:function(t,e){var i=this;return t===n?i._central.url():(i._central.url(t,e),i)},html:function(t){var e=this;return t===n?e._central.html():(e._central.html(t),e)},iframe:function(t){var e=this;return t===n?e._central.iframe():(e._central.iframe(t),e)},layout:function(t){var e=this;return t===n?e._central.layout():(e._central.layout(t),e)},menuBar:function(t){var e=this;return t===n?e._menuBar||null:(isWidget(t)?e._menuBar=t:isObject(t)&&(e._menuBar=Std.ui("MenuBar",t)),e.D.body.prepend(e._menuBar),e.renderState&&(e._menuBar.render(),e.updateHeight()),e)},toolBar:function(t){var e=this;
return t===n?e._toolBar||null:(isWidget(t)?e._toolBar=t:isObject(t)&&(e._toolBar=Std.ui("ToolBar",t)),e.D.body.insertBefore(e._toolBar,e.D.Client),e.renderState&&(e._toolBar.render(),e.updateHeight()),e)},collapsed:function(t,e){var n=this,i=function(){n.height(n.opts.height),n.D.body.removeStyle("height")},o=function(){n.D.body.css({zIndex:-1,position:"absolute",visibility:"hidden"})},r=function(t,e){n.D.body.animate("end").animate({to:{height:t}},150,e)};return n.opt("collapsed",t,function(){n.collapsible()&&(t===!0?(n[0].removeStyle("height"),e===!0?r(0,o):o()):(n.D.body.height(0).removeStyle(["visibility","position","zIndex"]),e===!0?r(n.height()-n.boxSize.height-n.opts.titleHeight,i):i()),n.titleButtons("collapse").toggleClass("_open",t))})},titleButtons:function(t,e){var i=this,o=i._titleButtons;return t===n?o:isString(t)&&e===n?o[t]:(i.appendTitleButton(t,e),i)},insertTitleButtonBefore:Std.func(function(t,e,n){var i=this,o=i.createTitleButton(t,e),r=i._titleButtons;null!==o&&n in r&&this.D.TitleButtons.insertBefore(r[n])},{each:[isArray]}),insertTitleButtonAfter:Std.func(function(t,e,n){var i=this,o=i.createTitleButton(t,e),r=i._titleButtons;null!==o&&n in r&&this.D.TitleButtons.insertAfter(r[n])},{each:[isArray]}),appendTitleButton:Std.func(function(t,e){var n=this,i=n.createTitleButton(t,e);null!==i&&this.D.TitleButtons.append(i)},{each:[isObject]})},main:function(t){t.D={},t._titleButtons={},t.initTitle(),t.initBody(),t.initClient(),t.initTitleEvents(),t.call_opts({menuBar:null,toolBar:null,titleIcon:null,titleIconClass:null,titleButtons:null,collapsible:!1},!0)}}),Std.ui.module("Window",{parent:"Panel",events:"minimize maximize restore close",action:{content:"html"},option:{defaultClass:"StdUI_Panel StdUI_Window",minWidth:180,minHeight:100,width:600,height:400,resizable:!0,draggable:!0,minimizable:!0,maximizable:!0,closable:!0,center:!0,modal:!1,minimize:!1,maximize:!1,title:"Window",renderTo:"body",closeAction:"remove"},"private":{locker:null,lastRect:null,windowResize:null},extend:{render:function(){var t=this,e=t.opts;e.center&&t.move("center"),e.modal&&t.initLocker(),t.call_opts({maximize:!1,resizable:!1,draggable:!1},!0),t.focus(1)},titleButtonClick:function(t){var e=this;switch(t){case"min":e.minimize(!0);break;case"max":e.maximize(!e.opts.maximize);break;case"close":e.close()}return e},visible:function(t){var e=this,n=e._locker;n&&n.visible(t)},remove:function(){var e=this;e._locker&&e._locker.remove(),e._windowResize&&Std.dom(t).off("resize",e._windowResize)}},"protected":{initLocker:function(){var t=this;t._locker=Std.ui("locker",{renderTo:t[0].parent(),opacity:.1,visible:!0})},initWindowEvent:function(){var e=this,n=e[0].offsetParent();return n.contains("body")&&(n=Std.dom(t)),Std.dom(t).on("resize",e._windowResize=function(){e.move(0,0).size(n.outerWidth(),n.outerHeight())}),e},initTitleButtons:function(){var t=this,e=t.opts;return t.appendTitleButton({min:"_min",max:"_max",close:"_close"}),t.D.TitleBar.on({dblclick:function(){e.maximizable&&t.maximize(!e.maximize)}}),t},initTitleContextMenu:function(){var t=this,e=t.opts,n=[{text:"Restore",iconClass:"_restore",click:function(){t.restore()}},{text:"Minimize",iconClass:"_min",enable:e.minimizable,click:function(){t.minimize(!0)}},{ui:"MenuItem",text:"Maximize",iconClass:"_max",enable:e.maximizable,click:function(){t.maximize(!0)}},{ui:"sep"},{text:"Hide Window",click:function(){t.hide()}},{ui:"MenuItem",text:"Move To",enable:!1,items:[{text:"center"}]},{ui:"sep"},{text:"Close",iconClass:"_close",css:{fontWeight:"bold"},enable:e.closable,click:function(){t.close()}}];t.plugin("contextMenu",{width:160,items:n,handle:t.D.TitleBar,on:{show:function(){var n=this.menu.items;n[0].enable(t._lastRect),n[2].enable(!t.maximize()),n[7].enable(e.closable)}}})},saveRect:function(){var t=this;return t._lastRect={top:t[0].css("top"),left:t[0].css("left"),width:t.width(),height:t.height()}}},"public":{minimizable:function(t){var e=this;return e.opt("minimizable",t,function(){e.titleButtons("min").visible(t)})},maximizable:function(t){var e=this;return e.opt("maximizable",t,function(){e.titleButtons("max").visible(t)})},closable:function(t){var e=this;return e.opt("closable",t,function(){e.titleButtons("close").visible(t)})},resizable:function(t){var e=this;return e.opt("resizable",t,function(){e.plugin("resize")||e.plugin("resize",{on:{stop:function(){}}}),e.plugin("resize").resizable(t)})},draggable:function(t){var e=this;return e.opt("draggable",t,function(){e.plugin("drag")||(e.plugin("drag",{handle:e.D.TitleBar}),e.plugin("drag").on({start:function(){e.D.Client.css("visibility","hidden")},stop:function(){e.D.Client.removeStyle("visibility")}})),e.plugin("drag").draggable(t)})},close:function(){var t=this,e=t.opts.closeAction;return e in t&&t.animation("close",function(){t[e]()},e),t.emit("close")},minimize:function(t){var e=this;return e.opt("minimize",t,function(){e.emit("minimize",t),e.animation("minimize",function(){e.visible(!t)},t)})},maximize:function(t){var e=this;return e.opt("maximize",t,function(){t===!1?e.restore():(e.titleButtons("max").addClass("_restore"),e._windowResize||e.initWindowEvent(),e.animation("maximize",function(){e._windowResize()},e.saveRect())),e.emit("maximize",t)})},restore:function(){var e=this,n=e._lastRect;return e.opts.maximize=!1,e.titleButtons("max").removeClass("_restore"),null!==n&&e.animation("restore",function(){e.width(n.width),e.height(n.height),e[0].css({top:n.top,left:n.left})},n),e._windowResize&&Std.dom(t).off("resize",e._windowResize),e.emit("restore")}},main:function(t,e,n){n.focussing(function(){t.toForeground()},null,!1),t.initTitleContextMenu(),t.initTitleButtons(),t.call_opts({minimizable:!0,maximizable:!0,closable:!0},!0)}}),Std.ui.module("MessageBox",{parent:"widget",events:"ok cancel close yes no abort retry ignore disagree apply buttonClick",option:{defaultClass:"StdUI_MessageBox",boxSizing:"border-box",renderTo:"body",type:"information",acceptEsc:!0,closable:!0,draggable:!0,title:null,value:null,icon:"auto",iconClass:"auto",text:"null",timeout:0,buttons:"ok",buttonsAlign:"right",inputType:null,inputWidth:"auto",inputHeight:"auto",detailedText:"",defaultButton:"ok",informativeText:null,tabIndex:9},"private":{hasIcon:!1,hasDetail:!1,hasInformativeText:!1},extend:{render:function(){var t=this,e=t.opts;t.initLocker(),t[0].css("zIndex",++Std.ui.status.zIndex),null!==t.input?(t.input.renderTo(t.D.BodyClientContentInput),t.input.focus(100)):e.defaultButton?t.defaultButton(e.defaultButton):t.focus(),t.updateLayout(),t.move("central")},remove:function(){var e=this,n=e._locker;n&&n.remove(),Std.dom(t).off("keyup",e._keyupHandle)}},"protected":{input:null,initIcon:function(){var t=this;return t.D.BodyClient.prepend(t.D.BodyClientIcon=newDiv("_icon")),t},initKeyboard:function(){var e=this,n=e.opts;return Std.dom(t).on("keyup",e._keyupHandle||(e._keyupHandle=function(t){var i=Std.dom(t.target),o=t.keyCode;if(27===o&&n.acceptEsc)e.remove();else if(39===o);else if(40===o);else if((13==o||32==o)&&i.hasClass("_button")){var r=e._buttons[e._defaultButton];r&&r.emit("click")}})),e},initEvents:function(){var t=this,e=!1;t[0].on("mousedown",function(t){t.stopPropagation()}).focussing(function(){e===!1&&(e=!0,t.initKeyboard()),t[0].css("zIndex",++Std.ui.status.zIndex)},null,!1)},initLocker:function(){var t=this,e="black",n=.1,i=t[0].offsetParent();switch(t.opts.type){case"warning":e="#FF8142",n=.6;break;case"error":e="#FF0505",n=.3;break;case"question":e="#4692D7",n=.2;break;case"success":e="#0CF4AB"}return t._locker=Std.ui("locker",{renderTo:i.contains("body")?"body":i,opacity:n,visible:!0,background:e}),t}},"public":{title:function(t){return this.opt("title",t,function(){this.D.TitleText.html(t)})},text:function(t){return this.opt("text",t,function(){this.D.BodyClientContentText.html(t)})},timeout:function(t){var e=this;return e.opt("timeout",t,function(){Std.func(function(){e.remove()},{delay:t})()})},updateLayout:function(){var t=this,e=t.opts,n=t.D;if("left"!=e.buttonsAlign){var i=n.Buttons.offsetWidth()-n.ButtonGroup.offsetWidth()-2;("warning"==e.type||"center"==e.buttonsAlign)&&(i/=2),n.ButtonSpacing.width(i)}},icon:function(t){var e=this;return e.opt("icon",t,function(){e.D.BodyClientIcon||(e.initIcon(),e.D.BodyClientIcon.html(newDom("img").attr("src",t)))})},iconClass:function(t){var e=this;return e.opt("icon",t,function(){e.D.BodyClientIcon||(e.initIcon(),e.D.BodyClientIcon.className("_icon "+t))})},value:function(t){var e=this,i=e.opts,o=e.input;return t===n?o?o.value():i.value:(o&&o.value(t),i.value=t,e)},informativeText:function(t){var e=this;return e.opt("informativeText",t,function(){e._hasInformativeText||(e._hasInformativeText=!0,e.D.BodyClientContent.prepend(e.D.InformativeText=newDiv("_informativeText"))),e.D.InformativeText.html(t)})},inputType:function(t){var e=this;return e.opt("inputType",t,function(){null!==e.input&&e.input.remove(),e.input=Std.ui(t,{width:e.opts.inputWidth,height:e.opts.inputHeight,value:e.value()})})},buttons:Std.func(function(t){var e=this;if(isString(t)){e._buttons[t]&&e._buttons[t].remove();var n=newDiv("_button").mouse({unselect:!0}).html(t.toUpperCase()).attr({tabindex:0,buttonName:t}).on("click",function(){e.emit(t),e.emit("buttonClick",t),e.remove()});e.D.ButtonGroup.append(e._buttons[t]=n)}},{each:[isArray,isString]}),defaultButton:function(t){var e=this;if(t==n)return e._defaultButton;var i=e._buttons[e._defaultButton=t];return i&&i.focus(),e},detailedText:function(t){var e=this;return t==n?e.D.Detail.html():(e._hasDetail||(e._hasDetail=!0,e.D.Body.append(e.D.Detail=newDiv("_detail"))),e.D.Detail.html(t),e)},closable:function(t){var e=this,n=e.D;return e.opt("closable",t,function(){n.TitleButtons_Close&&n.TitleButtons_Close.remove(),t!==!1&&n.TitleButtons.append(n.TitleButtons_Close=newDiv("_button _close").mouse({down:function(){return!1},click:function(){e.remove()}}))})},draggable:function(t){var e=this;return e.opt("draggable",t,function(){e.plugin("drag")||e.plugin("drag",{handle:e.D.Title}),e.plugin("drag").draggable(t)})}},main:function(t,e,n){t._buttons=[],t.D={Title:newDiv("_title"),TitleText:newDiv("_text"),TitleButtons:newDiv("_buttons"),Body:newDiv("_body"),BodyClient:newDiv("_client"),BodyClientContent:newDiv("_content"),BodyClientContentText:newDiv("_text"),BodyClientContentInput:newDiv("_input"),Buttons:newDiv("_buttons"),ButtonSpacing:newDiv("_buttonSpacing"),ButtonGroup:newDiv("_buttonGroup")},t.D.Title.append([t.D.TitleText,t.D.TitleButtons]),t.D.Body.append([t.D.BodyClient,t.D.Buttons.append([t.D.ButtonSpacing,t.D.ButtonGroup]),t.D.Detail]),t.D.BodyClient.append(t.D.BodyClientContent),t.D.BodyClientContent.append([t.D.BodyClientContentText,t.D.BodyClientContentInput]),n.append([t.D.Title,t.D.Body]),null===e.title?t.title(e.type):t.title(e.title),"none"!==e.type&&(t.iconClass(e.type),n.addClass("_"+e.type)),null===e.informativeText&&"warning"==e.type&&(e.informativeText="warning"),t.call_opts({icon:"auto",iconClass:"auto",text:"",buttons:"",timeout:0,draggable:!1,closable:!1,inputType:null,detailedText:"",informativeText:null},!0),t.initEvents()}}),Std.ui.module("Pagination",{parent:"widget",option:{level:3,total:0,page:0,pageSize:9,pageCount:"auto",tabIndex:null,link:!1,hotKey:!1,text:"<b><?=page?></b> / <b><?=pageCount?></b><b style='margin-left: 10px'>total:</b><?=total?>",href:"#<?=page?>",defaultClass:"StdUI_Pagination",height:34,first:"First",last:"Last",prev:"Prev",next:"Next",editable:!0},events:"change",extend:{render:function(){var t=this;t.refreshPages(),t.refreshText(),t.refreshList()},remove:function(){var t=this;t._pageList&&t._pageList.remove()}},"protected":{initKeyboard:function(){var t=this;return t},initEvents:function(){var t=this,e=t.D;return t[0].on("mouseenter","._buttons > ._button",function(n){var i=this.mouse({auto:!1,click:function(){if(!i.hasClass("selected")){var n=Std.each("first prev next last",function(n,o){return o in e&&e[o].is(i)?(t.page(t.pageIndex(o)),!0):void 0});n!==!0&&t.page(t.pageIndex(i.text()))}}},n)}),t},initElements:function(){var t=this,e=t.D={main:newDom("tr"),buttons:newDom("td"),text:newDom("td","_text")};return t[0].append(newDom("table").attr({cellspacing:0,cellpadding:0}).append(newDom("tbody").append(e.main=newDom("tr").append([e.left,e.buttons.append([e.left=newDiv("_buttons -left"),e.pages=newDiv("_buttons -pages"),e.right=newDiv("_buttons -right"),e.jump=newDiv("_jump")]),e.text])))),t},createButton:function(t){var e=this,n=e.opts,i=newDom("a"),o="_button";return n.link&&i.attr("href",new Std.template(n.href).render({page:e.pageIndex(t)})),-1!="first prev next last".indexOf(t)?(i.html(n[t]),o+=" -"+t):i.html(t),i.className(o)}},"public":{total:function(t){return this.opt("total",t,function(){this.refreshText()})},text:function(t){return this.opt("text",t,function(){this.refreshText()})},editable:function(t){var e=this;return e.opt("editable",t,function(){t?e.refreshList():e._pageList&&e._pageList.remove()})},pageSize:function(t){return this.opt("pageSize",t,function(){this.refreshPages().refreshText()})},page:function(t){var e=this,i=e.opts,o=e._pageList;return t===n?int(i.page):(t!=i.page&&(i.page=t=~~t,o&&o.value()!=t&&o.value(t),e.refreshPages().refreshText().emit("change",t)),e)},pageIndex:function(t){switch(t){case"first":t=1;break;case"prev":t=this.page()-1;break;case"next":t=this.page()+1;break;case"last":t=this.pageCount()}return~~t},pageCount:function(t){var e=this,i=e.opts;return t===n?"auto"===i.pageCount?Math.ceil(i.total/i.pageSize):i.pageCount:(i.pageCount=t,e.refreshText().refreshList())},pageNumbers:function(){for(var t=this,e=t.opts,n=e.page,i=n,o=t.pageCount(),r=Math.floor(e.pageSize/2),a=[],s=n-1;s>n-1-r&&!(1>s);s--)i=s;for(s=n+1;n+1+r>s&&!(s>Math.ceil(e.total/e.pageSize)||s>o);s++)o=s;for(s=i;o>=s;s++)a.push(s);return a},refreshText:function(){var t=this;return t.renderState&&new Std.template(t.opts.text).renderTo(t.D.text.clear(),{page:t.page(),pageSize:t.pageSize(),pageCount:t.pageCount(),total:t.total()}),t},refreshList:function(){var t=this;return t.opts.editable?(t._pageList||(t._pageList=Std.ui("ComboBox",{inputMode:"input",value:t.page(),renderTo:t.D.jump,width:60}),t._pageList.on("change",function(){t.page(~~this.value())})),t._pageList.clear().append(function(){for(var e=[],n=1,i=t.pageCount();i>=n;n++)n>1e4&&i>n+1e4?n+=9999:n>1e3&&i>n+1e3?n+=999:n>100&&i>n+100&&(n+=99),e.push(n+"");return e}()).value(t.page()),t):t},refreshPages:function(){var t=this.clear(),e=t.opts,n=t.D,i=e.page;return t.renderState?(i>1&&n.left.append([n.first=t.createButton("first"),n.prev=t.createButton("prev")]),Std.each(t.pageNumbers(),function(e,o){var r=t.createButton(o).appendTo(n.pages);i==o&&r.addClass("selected")}),i<t.pageCount()&&n.right.append([n.next=t.createButton("next"),n.last=t.createButton("last")]),t):t},repaint:function(){var t=this;return t.refreshPages(),t.refreshText(),t.refreshList(),t},clear:function(){var t=this,e=t.D;return e.left.clear(),e.pages.clear(),e.right.clear(),Std.each("first prev next last",function(t,n){delete e[n]}),t}},main:function(t,e){e.change&&t.on("change",e.change),t.initElements(),t.initEvents(),t.initKeyboard()}}),Std.plugin.module("dataSourcePagination",{option:{dataPath:""},"protected":{initDataGrid:function(){var t=this,e=t.opts,n=t.owner,i=t._pagination,o=function(){n[2].height(n.height()-n.opts.headerHeight-n.boxSize.height-1-i.height())};return n.on("resize",o),n.on("dataSourceLoad",function(t){var n=Std.mold.dataPath(t,e.dataPath);Std.each("total pageSize pageCount page",function(t,e){i.opts[e]=n[e]}),i.refreshPages().refreshText().refreshList()}),i.renderTo(n)[0].css("borderTopColor",n[0].css("borderTopColor")),n.renderState&&o(),t}},"public":{remove:function(){this._pagination.remove()}},main:function(t,e,n){switch(t._pagination=Std.ui("Pagination",e),n.ui){case"DataGrid":t.initDataGrid()}}}),Std.model("ui.Progress",{parent:"widget",events:"finished change",action:{content:"value"},option:{defaultClass:"StdUI_Progress",level:3,min:0,max:100,value:0,text:"%.2f%%",color:"blue"},extend:{width:function(t){var e=this,n=e.D;isNumber(t)||(t=e.width()),n.texts.width(t-e.boxSize.width),e.refresh()},height:function(t){var e=this,n=this.D;isNumber(t)||(t=e.height()),n.location.height(t-=e.boxSize.height),n.texts.css({height:t,lineHeight:t})}},"protected":{updateProgress:function(){var t=this,e=t.opts,n=e.width;return isNumber(n)||(n=t.width()-t.boxSize.width),t.D.location.width(int((t.value()-e.min)*(n/(e.max-e.min)))),t.text(e.text)}},"public":{refresh:function(){return this.value(this.opts.value)},min:function(t){return this.opt("min",t,function(){this.refresh()})},max:function(t){return this.opt("max",t,function(){this.refresh()})},range:function(t,e){var i=this,o=i.opts;return t===n?{min:o.min,max:o.max}:i.refresh(o.min=t,o.max=e)},percent:function(t){var e=this,i=e.opts;return t==n?Std.convert.percent(int(i.value-i.min),i.max-i.min):e.value(int((i.max-i.min)*t/100))},color:function(t){var e=this,i=e.opts;return t===n?i.color:(e[0].removeClass("-"+i.color).addClass("-"+(i.color=t)),e)},text:function(t){var e=this,n=e.D;return e.opt("text",t,function(){n.texts.html(sprintf(t,e.percent(),e.value(),e.range().max))})},value:function(t){var e=this,i=e.opts;return t===n?i.value:(t>i.max?t=i.max:t<i.min&&(t=i.min),i.max==t?e.addClass("-finished").emit("finished"):i.value==i.max&&i.max!=t&&e.removeClass("-finished"),i.value!==t&&e.emit("change",i.value=float(t)),e.updateProgress())}},main:function(t,e,n){var i=t.D={};n.addClass("-"+e.color).append([i.text=newDiv("_text"),i.location=newDiv("_location").append(i.text2=newDiv("_text"))]),i.texts=Std.dom.united([i.text,i.text2])}}),Std.ui.module("CProgress",{model:"ui.Progress",option:{width:128,height:128,minHeight:64,minWidth:64,color:"blue"},"private":{direction:"circle"}}),Std.ui.module("HProgress",{model:"ui.Progress",option:{height:26,minWidth:35,minHeight:15},"private":{direction:"horizontal"}}),Std.ui.module("VProgress",{model:"ui.Progress",option:{width:26,minHeight:35,minWidth:15},"private":{direction:"vertical"}}),Std.ui.module("Accordion",{parent:"widget",events:"change",option:{level:4,defaultClass:"StdUI_Accordion",switchType:"click",items:null,height:400,template:null,titleHeight:30,collapsible:!1,clientPadding:5,activeItem:0,boxSizing:"border-box"},action:{children:"append",childNodes:function(t,e){this.append(Std.each(e,function(t,e){return{icon:e.attr("icon"),text:e.attr("title"),content:e.html()}},!0))}},"private":{current:null},extend:{render:function(){var t=this,e=t.opts,n=t.items;n.length>0&&(t._current=n[e.activeItem])&&(t.repaint(),t._current.client.main.show())},height:function(){var t=this;null!=t._current&&t.repaint()},remove:function(t){var e=this;if(t===n)return e.clear();if(isNumber(t))e.removeItem(t);else if(isArray(t))for(var i=t.length-1;i>=0;i--)e.removeItem(t[i]);e.renderState&&e.repaint()}},"protected":{computeClientHeight:function(){var t=this,e=t.opts;return Math.floor(t.height()-t.boxSize.height-t.length*(e.titleHeight+2))+1},appendItem:function(t){var e=this,n=e.createItem(t);return e[0].append(n[0]),e.items.push(n),e.length++,e},removeItem:function(t){var e=this,n=e.items[t];return isWidget(n.client.widget)&&n.client.widget.remove(),n[0].remove(),e.length--,e.items.remove(t),e},refreshClient:function(t,e){var n=t.widget;return isWidget(n)&&(n.renderState||n.render(),t.main.animate("end"),n.height(e)),this},createItem:function(t){var e=this,n=e.createItemHeader(t.text,t.icon,t.iconClass),i=e.createItemClient(t.content);return{0:newDiv("_item").append([n.main,i.main]),header:n,client:i}},createItemHeader:function(t,e,n){var i={main:newDiv("_title").height(this.opts.titleHeight)};return(isString(e)||isString(n))&&(i.main.append(i.icon=newDiv("_icon")),n&&i.icon.addClass(n),e&&newDom("img").appendTo(i.icon).attr("src",e)),i.main.append([i.text=newDiv("_text").html(t),i.arrow=newDiv("_arrow")]),i},createItemClient:function(t){var e=this,n=e.opts,i=newDiv("_client"),o=null;return isString(t)?o=Std.ui("widget",{html:t,tabIndex:null}):isObject(t)&&(o=isWidget(t)?t:null!==n.template?Std.ui("TemplateItem",{data:t,template:n.template}):Std.ui(t.ui||"widget",Std.extend({tabIndex:null},t))),null!==o&&(o[0].padding(o.opts.padding=n.clientPadding),o[0].appendTo(i)),{main:i,widget:o}},initEvents:function(){var t=this,e=t.opts;return t[0].delegate("mouseenter","._item > ._title",function(n){var i=this.parent().index(),o=e.switchType;"mouseenter"===o&&t.items[i]!==t._current&&t.select(i),this.mouse({auto:!1,unselect:!0,click:function(){t.select(i)}},n)}),t}},"public":{length:0,activeItem:function(t){var e=this;return t===n?e.items.indexOf(e._current):e.select(t)},template:function(t){var e=this,i=e.opts;return t===n?i.template:(isString(t)&&(t=Std.template(t)),t instanceof Std.template&&(i.template=t),e)},repaint:function(){var t=this,e=t._current;if(null!=e){var n=t.computeClientHeight();e.client.main.height(n),e[0].addClass("selected"),t.refreshClient(e.client,n)}return t},insert:function(t,e){var n=this,i=n.createItem(t);return e<n.length?n[0].insertBefore(i[0],n.items[e][0]):n[0].append(i[0]),n.items.insert(i,e),n.length++,n.renderState&&n.repaint(),n},append:function(t){var e=this;if(isArray(t))for(var n=0,i=t.length;i>n;n++)e.appendItem(t[n]);else e.appendItem(t);return e.renderState&&e.repaint(),e},select:function(t){var e=this,n=e.opts,i=e.items,o=e.computeClientHeight(),r=e._current;return null!=r&&(r[0].removeClass("selected"),r.client.main.css("overflow","hidden").animate("end").animate({100:{height:0}},150)),n.collapsible&&r===e.items[t]?(e._current=null,e):(e._current!==i[t]&&e.emit("change",t),i[t].client.main.removeClass("overflow").animate("end").animate({100:{height:o}},150,function(){e.refreshClient(i[t].client,o)}),e._current=i[t],e._current[0].addClass("selected"),e)},clear:function(){for(var t=this,e=t.items.length-1;e>=0;e--)t.removeItem(e);return t}},main:function(t,e){t.items=[],null!==e.template&&t.template(e.template),null!==e.items&&t.append(e.items),t.initEvents()}}),Std.ui.module("TabButton",{parent:"Button",option:{height:30,level:4,closable:!1,styleType:"text",defaultClass:"StdUI_TabButton"},"private":{selected:!1},"protected":{initClosableElement:function(){var t=this,e=t.D;return e.tr1.append(e.closeTD=newDom("td","_close").append(e.closeButton=newDiv("_closeButton").mouse({down:function(t){t.stopPropagation()},click:function(){var e=t.parent();e&&e.remove()}}))),t}},"public":{closable:function(t){var e=this;return e.opt("closable",t,function(){t===!0?e.D.closeTD||e.initClosableElement():(e.D.closeButton.remove(),e.D.closeTD.remove())})},select:function(t){var e=this;return t===n?e._selected:(e.toggleClass("selected",e._selected=t),e)}},main:function(t,e){e.closable&&t.initClosableElement()}}),Std.ui.module("TabPanel",function(){var t=Std.module({option:{button:null,content:null,value:null},"public":{value:function(t){return this.opt("value",t)},index:function(){return this.parent.items.indexOf(this)},select:function(){return this.parent.select(this.index()),this},remove:function(){return this.parent.removeTab(this.index()),this}},main:function(t,e){var n=this,i=n.init_opts(t),o=null,r=null;if(isString(i.button))o=Std.ui("TabButton",{parent:n,text:i.button,height:e.opts.tabButtonHeight,closable:e.opts.tabClosable});else if(isObject(i.button)){var a=i.button;a.parent=n,a.height=e.opts.tabButtonHeight,"closable"in a||(a.closable=e.opts.tabClosable),o=Std.ui("TabButton",i.button)}isString(i.content)?r=Std.ui("widget",{tabIndex:null,defaultClass:"StdUI_TabContent",html:i.content}):isWidget(i.content)?r=Std.ui("widget",{tabIndex:null,defaultClass:"StdUI_TabContent",layout:{ui:"VBoxLayout",items:[i.content]}}):isLayout(i.content)?r=Std.ui("widget",{tabIndex:null,defaultClass:"StdUI_TabContent",layout:i.content}):isPlainObject(i.content)&&(r=Std.ui(i.content.ui||"widget",Std.extend({tabIndex:null,defaultClass:"StdUI_TabContent"},i.content))),n.parent=e,n.button=o,n.content=r}});return{parent:"widget",option:{defaultClass:"StdUI_TabPanel",level:4,height:300,tabButtonHeight:32,tabButtonSpacing:2,tabClosable:!1,tabDroppable:!1,maxTabButtonWidth:"50%",contentPadding:5,deferRender:!0,activeIndex:0,items:null,tabAlign:"left",tabPosition:"top"},events:"removeTab selectTab","private":{activeIndex:null,tabBarOverflowed:!1,lastWidth:null,lastHeight:null,direction:null,timer1:null,dropDownMenu:null},extend:{render:function(){var t=this,e=t.opts;t.items.each(function(t,n){n.button.render(),e.deferRender||n.content.render()}),t.initEvents(),t.initKeyboard(),t.select(e.activeIndex),t.tabBarOverflowCheck()},width:function(){this.updateLayout()},height:function(){var t=this,e=t.D,n=t.computeContentHeight();t.items.each(function(t,e){e.content.height(n)}),e.contents.height(n)},remove:function(t){var e=this,i=e.items;return t===n?(e._dropDownMenu&&e._dropDownMenu.remove(),i.each(function(t,e){e.button.remove(),e.content.remove()}),i.clear(),void 0):(isObject(t)&&(t=i.indexOf(t)),-1!==t&&i[t]&&e.removeTab(~~t),void 0)}},"protected":{initKeyboard:function(){var t=this;return t},initData:function(){var t=this,e=t.opts;return t.items=[],null!==e.items&&t.append(e.items),t.call_opts({contentPadding:0},!0)},initElements:function(){var t=this,e=t.D={};return t[0].append([e.contents=newDiv("_contents")]),t},initEvents:function(){var t=this;return t.D.buttons.delegate("mousedown",".StdUI_TabButton",function(e){var n=this.index(),i=t.items[n].button;1===e.which&&(t.select(n),"vertical"===t._direction?t.verticalTabButtonClick(n,i):t.horizontalTabButtonClick(n,i))}),t},initTabBar:function(){var t=this,e=t.D;return t[0].append(e.tabBar=newDiv("_tabBar").height(t.opts.tabButtonHeight).append([e.leftTools=newDiv("_tools _left"),e.line=newDiv("_line"),e.tabs=newDiv("_tabs").append(e.buttons=newDiv("_buttons")),e.rightTools=newDiv("_tools _right")])),t},initClient:function(){var t=this,e=t.D;switch(e.contents=newDiv("_contents"),t.opts.tabPosition){case"right":case"bottom":t[0].prepend(e.contents);break;case"left":case"top":t[0].append(e.contents)}return t.addClass("_"+t.opts.tabPosition),e},initScrollButtons:function(t,e,n){var i=this,o=i.opts,r=i.D,a={down:t,delay:10,interval:3};return r.leftTools.append(r.prevBtn=newDiv("_scrollButton _backward").height(o.tabButtonHeight-1).mouse(Std.extend(a,{longpress:e})).append(newDiv("_icon"))),r.rightTools.append([r.nextButton=newDiv("_scrollButton _forward").height(o.tabButtonHeight-1).mouse(Std.extend(a,{longpress:n})).append(newDiv("_icon")),r.controlHand=newDiv("_controlHand").height(o.tabButtonHeight-1).mouse({down:function(t){1===t.which&&(i._dropDownMenu?i._dropDownMenu.remove():(this.addClass("selected"),i.initDropDownMenu()))}}).append(newDiv("_icon"))]),i._tabBarOverflowed=!0,i},initHScrollButtons:function(){if(this._tabBarOverflowed)return this;var t=this,e=t.opts,n=t.D,i=0,o=0,r=0,a=e.tabButtonSpacing,s=n.tabBar.width()-a;return t.initScrollButtons(function(){i=0,r=n.buttons.css("margin-top"),o=n.tabs.height(),Std.each(t.items,function(t,e){i+=e.button.height()+a})},function(){a>r&&n.buttons.css("margin-top",r+=3)},function(){i+r>o&&n.buttons.css("margin-top",r-=3)}),Std.dom.united([n.prevBtn,n.nextButton,n.controlHand]).css({height:25,width:s}),n.buttons.css("margin-top",a),t.updateTabsHeight()},initVScrollButtons:function(){if(this._tabBarOverflowed)return this;var t=this,e=t.opts,n=t.D,i=0,o=0,r=0,a=e.tabButtonHeight-1,s=e.tabButtonSpacing;return t.initScrollButtons(function(){i=0,r=n.buttons.css("margin-left"),o=n.tabs.width(),Std.each(t.items,function(t,e){i+=e.button.width()+s})},function(){s>r&&n.buttons.css("margin-left",r+=3)},function(){i+r>o&&n.buttons.css("margin-left",r-=3)}),n.prevBtn.height(a),n.nextButton.height(a),n.buttons.css("margin-left",s),t.updateTabsWidth()},initDropDownMenu:function(){var t=this,n=t.D,i=t.opts.tabButtonHeight;if(t._dropDownMenu)return t;var o=function(t){var e=t.target;r[0].contains(e)||n.controlHand.contains(e)||r.remove()},r=t._dropDownMenu=Std.ui("Menu",{renderTo:t,maxHeight:t.height()-i,css:{position:"absolute",boxShadow:"none"},items:[{text:"Close All",click:function(){for(var e=t.items.length-1;e>=0;e--){var n=t.items[e];n&&n.button.closable()&&t.remove(n)}t.tabBarOverflowCheck()}},{text:"First Page",click:function(){t.activeIndex(0).updateTabScroll()}},{text:"Last Page",click:function(){t.activeIndex(t.items.length-1).updateTabScroll()}},{ui:"sep"}],on:{itemPress:function(){r.remove()},visible:function(t){n.controlHand.toggleClass("selected",t)},remove:function(){n.controlHand.removeClass("selected"),t._dropDownMenu=null,Std.dom(e).off("mousedown",o)}}}).toForeground();switch(t.opts.tabPosition){case"top":r[0].css({right:0,top:i-1});break;case"right":r[0].css({right:0,bottom:n.controlHand.outerHeight()-1});break;case"bottom":r[0].css({right:0,bottom:i});break;case"left":r[0].css({left:0,bottom:n.controlHand.outerHeight()-1})}return Std.each(t.items,function(e,n){var i=n.button,o=i.text(),a=i.icon(),s=i.iconClass();r.append({text:o,icon:a,iconClass:s,checked:t._activeItem===n,click:function(){t.activeItem(n).updateTabScroll()}})}),Std.dom(e).on("mousedown",o),t},computeContentHeight:function(){var t=this,e=t.opts,n=t.D,i=t.height(),o=i-2*e.contentPadding-2;switch(e.tabPosition){case"left":case"right":n.tabBar.height(i-t.boxSize.height),t._tabBarOverflowed&&t.updateTabsHeight();break;case"top":n.line.css("top",e.tabButtonHeight-1);case"bottom":o-=e.tabButtonHeight}return o},verticalTabButtonClick:function(t,e){var n=this,i=e.width(),o=n.D.tabs.width(),r=e[0].position().x,a=n.opts.tabButtonSpacing;return r+i>o?n.D.buttons.animate("end").animate({to:{"margin-left[+]":o-(r+i)-a}},100):0>r&&n.D.buttons.animate("end").animate({to:{"margin-left[-]":r-a}},100),n},horizontalTabButtonClick:function(t,e){var n=this,i=e.height(),o=n.D.tabs.height(),r=e[0].position().y,a=n.opts.tabButtonSpacing;return r+i>o?n.D.buttons.animate("end").animate({to:{"margin-top[+]":o-(r+i)-a}},100):0>r&&n.D.buttons.animate("end").animate({to:{"margin-top[-]":r-a}},100),n},tabBarOverflowCheck:function(){var t=this,e=0,n=t.opts.tabButtonSpacing;switch(t._direction){case"horizontal":Std.each(t.items,function(t,i){e+=i.button.height()+n}),e>t.height()?t.initHScrollButtons():t._tabBarOverflowed&&t.removeScrollButtons();break;case"vertical":Std.each(t.items,function(t,i){e+=i.button.width()+n}),e>t.width()?t.initVScrollButtons():t._tabBarOverflowed&&t.removeScrollButtons()}return t},removeScrollButtons:function(){var t=this,e=t.D;return e.buttons.css({marginTop:0,marginLeft:0}),Std.dom.united([e.prevBtn,e.nextButton,e.controlHand]).remove(),t._dropDownMenu&&t._dropDownMenu.remove(),t._tabBarOverflowed=!1,t.updateTabsWidth()},updateTabsWidth:function(){var t=this,e=t.D;return e.tabs.width(t.width()-e.leftTools.width()-e.rightTools.width()),t},updateTabsHeight:function(){var t=this,e=t.D;return e.tabs.height(t.height()-e.leftTools.height()-e.rightTools.height()),t},updateTabScroll:function(){var t=this,e=t.activeIndex();return t["horizontal"===t._direction?"horizontalTabButtonClick":"verticalTabButtonClick"](e,t.items[e].button),t},updateHorizontalLayout:function(){var t=this,e=t.D,n=t.width(),i=e.tabBar.width();switch(t.opts.tabPosition){case"left":e.line.css("left",i-1);case"right":e.contents.width(n-2*t.opts.contentPadding-i-2)}return t.items.each(function(e,o){o.content.width(n-2*t.opts.contentPadding-i-2)}),t},updateVerticalLayout:function(){var t=this,e=t.opts,n=t.width()-2*e.contentPadding-t.boxSize.width-2;return t.tabBarOverflowCheck(),t._tabBarOverflowed&&t.updateTabsWidth(),t.items.each(function(t,e){e.content.width(n)}),t},updateLayout:function(){var t=this;return null!==t._timer1&&clearTimeout(t._timer1),t._timer1=setTimeout(function(){"horizontal"===t._direction?t.updateHorizontalLayout():t.updateVerticalLayout()},0),t},convertIndex:function(t,e){var n=this,i=-1,o=n.items;if("first"===t)i=0;else if("last"===t)i=o.length-1;else if("beside"===t){var r=o.length;r-1>e?i=e:r>1?i=e-1:1===r&&(i=0)
}return i}},"public":{appendTab:function(t,e){return this.insertTab(t,-1,e)},contentPadding:function(t){var e=this;return e.D.contents.css("padding",t+"px"),e},select:function(t,e){var n=this;return isString(t)&&(t=n.convertIndex(t,e)),-1!==t&&t<n.items.length&&(n.activeIndex(t),n.emit("selectTab",[t,n.items[t]],!0)),n},activeIndex:function(t){var e=this,i=e.items;return t===n?i.indexOf(e._activeItem):(i[t]&&e.activeItem(i[t]),e)},activeItem:function(t){var e=this,i=e.items;if(t===n){var o=e.activeIndex();return-1==o?null:i[o]}var r=e._activeItem;return r&&(r.button.select(!1),r.content.removeClass("_visible")),t.button.select(!0),t.content.addClass("_visible"),e._activeItem=t,e.updateLayout(),t.content.renderState||(t.content.height(e.computeContentHeight()),t.content.render()),e},insert:function(t,e,n){return this.insertTab(t,e,n)},append:function(t){var e=this;return isArray(t)?Std.each(t,function(t,n){e.appendTab(n,!1)}):isObject(t)&&e.appendTab(t,!1),e.renderState&&(e.tabBarOverflowCheck(),e.updateLayout()),e},insertTab:function(e,n,i){var o=this,r=o.opts,a=o.D,s=new t(e,this);return-1===n?(a.buttons.append(s.button[0]),a.contents.append(s.content[0]),o.items.push(s)):(a.buttons.insert(s.button[0],n),a.contents.insert(s.content[0],n),o.items.insert(s,n)),o.renderState&&(s.button.render(),i!==!1&&(o.tabBarOverflowCheck(),o.updateLayout()),r.deferRender||(s.content.height(o.computeContentHeight()),s.content.render())),s},removeTab:function(t){var e=this,n=e.items,i=n[t],o=e.activeIndex();return n[t].button.remove(),n[t].content.remove(),e.items.remove(t),t===o&&e.select("beside",t),e.tabBarOverflowCheck().emit("removeTab",[t,i],!0)},clear:function(){var t=this;return t.items.each(function(t,e){e.button.remove(),e.content.remove()}),t.items.clear(),t._activeItem=null,t}},main:function(t,e){switch(e.tabPosition){case"left":case"right":t._direction="horizontal";break;case"top":case"bottom":t._direction="vertical"}t.D={},t.initTabBar(),t.initClient(),t.initData()}}}),Std.model("ui.Slider",{parent:"widget",events:"dragStart dragStop change",action:{content:"value"},option:{min:0,max:100,value:0,color:"#5FA8DB",defaultClass:"StdUI_Slider",handleWidth:18,handleHeight:18},extend:{init_boxSize:function(){var t=this;t.handleBoxSize=t.D.handle.boxSize()},render:function(){var t=this,e=t.opts;t.D.handle.css({width:e.handleWidth-t.handleBoxSize.width,height:e.handleHeight-t.handleBoxSize.height}),t.call_opts("color"),t.on("resize",t.refresh.bind(t)),t.refresh(),t.initDrag(),t.initEvents()}},"protected":{updateProgress:function(t){var e=this;switch(e._direction){case"horizontal":e.D.progress.width(t);break;case"vertical":e.D.progress.height(t)}return e},updateValue:function(t){var e=this,n=e.opts,i=0,o=0,r=0,a="",s=null,l=n.max-n.min,u=e._direction;return"horizontal"===u?(i=e.width(),a="left",o=e.boxSize.width,r=n.handleWidth,s=Math.round((i-o-r)/l*(t-n.min)),e.D.handle.css(a,s)):"vertical"===u&&(i=e.height(),a="top",o=e.boxSize.height,r=n.handleHeight,s=Math.round((i-o-r)/l*(t-n.min)),e.D.handle.css(a,(i-o-r)/l*(l-t-n.min))),e.updateProgress(s+r/2),e.emit("change",n.value=t)},initEvents:function(){var t=this,e=!1;return t[0].focussing(function(){this.addClass("focus"),e===!1&&(e=!0,t.initKeyboard())},function(){this.removeClass("focus")}),t},initKeyboard:function(){var t=this;return t.on("keydown",function(e){switch(e.keyCode){case 37:case 38:t.value(t.value()-1);break;case 39:case 40:t.value(t.value()+1)}})},initDrag:function(){var t,n,i,o=this,r=o.opts,a=0,s=0,l=function(){t=o[0].offset(),"horizontal"===o._direction?(n="pageX",i="x",s=r.handleWidth,a=o.width()-o.boxSize.width):"vertical"===o._direction&&(n="pageY",i="y",s=r.handleHeight,a=o.height()-o.boxSize.height)},u=function(e){var l=e[n]-t[i],u=0;"pageX"===n?u=r.min+Math.round((l-s/2)/(a-s)*(r.max-r.min)):"pageY"===n&&(u=r.min+Math.round((a-l-s/2)/(a-s)*(r.max-r.min))),o.value(u)};return o[0].mouse({down:function(t){1===t.which&&(l(),Std.dom(e).on("mousemove",u(t)||u),t.preventDefault(),o.emit("dragStart"))},up:function(){Std.dom(e).off("mousemove",u),o.emit("dragStop")}}),o}},"public":{refresh:function(){return this.value(this.opts.value)},min:function(t){return this.opt("min",t,function(){this.refresh()})},max:function(t){return this.opt("max",t,function(){this.refresh()})},color:function(t){return this.opt("color",t,function(){this.D.progress.css("background",t)})},range:function(t,e){var i=this,o=i.opts;return t===n?{min:o.min,max:o.max}:(o.min=t,o.max=e,i)},value:function(t){var e=this,i=e.opts;return t===n?i.value:((t=int(t))<i.min?t=i.min:t>i.max&&(t=i.max),e.updateValue(t),e)}},main:function(t,e,n){var i=t.D={};n.addClass("_"+t._direction).append([i.client=newDiv("_client").append(i.progress=newDiv("_progress")),i.handle=newDiv("_handle").attr("tabindex",1)])}}),Std.ui.module("HSlider",{model:"ui.Slider",option:{level:3,height:22},"private":{direction:"horizontal"},extend:{height:function(){var t=this,e=t.opts,n=t.D,i=t.height();if(t.handleBoxSize){var o=e.handleHeight-t.handleBoxSize.height;n.handle.css({top:(i-o)/2})}n.client.css("top",Math.round((i-n.client.height())/2))}}}),Std.ui.module("VSlider",{model:"ui.Slider",option:{level:3,width:22,height:200},"private":{direction:"vertical"},extend:{width:function(){var t=this,e=t.opts,n=t.D,i=t.width();if(t.handleBoxSize){var o=e.handleWidth-t.handleBoxSize.width;n.handle.css({left:(i-o)/2})}n.client.css("left",Math.round((i-n.client.width())/2))}}}),Std.ui.module("Tree",function(){var t=Std.module({option:{id:null,tree:null,type:null,icon:null,text:"",value:null,iconClass:null,parent:null,selected:!1,checked:!1,checkable:!1},"private":{readJSON:function(t,e,n){return t.addClass("_loading"),isString(e)?Std.ajax.json(e,n).success(function(){t.removeClass("_loading")}):isObject(e)&&Std.ajax.json(Std.extend({success:n},e)).success(function(){t.removeClass("_loading")}),this},createCheckBox:function(){var t=this,e=t.D,n=e.checkbox=newDom("i","_checkbox").prependTo(e.anchor);return t.checked()&&n.addClass("checked"),t},createChildNode:function(e){var n=this,i=n.tree(),o=e.type,r=i.checkable();!r||"checkable"in e||(e.checkable=r),o&&o in i._types&&(e=i.makeNodeOption(o,e));var a=new t(i,e);return a.parent(n),a},createChildNodes:function(t){var e=this;return e.D.ul=newDom("ul","_container_ul").appendTo(e.D.li),e._items?e._items.clear():e._items=[],Std.each(t,function(t,n){var i=e._createChildNode(n);e._items[t]=i.insertTo(e.D.ul)}),e},createNodeIcon:function(){var t=this,e=t.opts,n=e.icon,i=e.iconClass;return(n||i)&&(i=isString(i)?"_icon "+i:"_icon",t.D.icon=newDom("i",i).appendTo(t.D.anchor),isString(n)&&t.D.icon.append(newDom("img").attr("src",n))),t},createNodeAnchor:function(){var t=this,e=t.opts,n=t.D.anchor=newDom("a","_anchor").appendTo(t.D.li.append(t.D.hand=newDom("i","_hand _empty"))).on("dragstart",Std.func(!1));return e.checkable&&t._createCheckBox(),t._createNodeIcon(),e.color&&n.color(e.color),e.href&&n.attr("href",e.href),e.target&&n.attr("target",e.target),e.text&&n.append(t.D.text=newDom("span").html(e.text)),t},updateCheckBox:function(t){var e=this,n=e.opts;if(e._items)for(var i=0,o=e._items.length;o>i;i++)e._items[i].checked(t);if(n.items)for(var i=0,o=n.items.length;o>i;i++)n.items[i].checked=t;return e}},"public":{id:function(t){return this.opt("id",t)},tree:function(t){return this.opt("tree",t)},value:function(t){return this.opt("value",t)},parent:function(t){return this.opt("parent",t)},checkable:function(t){return this.opt("checkable",t)},index:function(){return this.parent()._items.indexOf(this)},text:function(t){return this.opt("text",t,function(){this.D.text.text(t)})},expanded:function(t){return this.opt("expanded",t,function(){this.expand(t)})},expandAll:function(){var t=this.expanded(!0);return Std.each(t._items,function(t,e){e.expandAll()}),t},collapseAll:function(){var t=this.expanded(!1);return Std.each(t._items,function(t,e){e.collapseAll()}),t},count:function(){var t=this,e=t.opts;return t._items?t._items.length:e.items?e.items.length:0},path:function(e){var n=this,i=[];do n instanceof t&&("name"===e?i.push(n.text()):i.push(n.index()));while(n=n.parent());return i.reverse().join("/")},update:function(){var t=this,e=t.opts,n="_hand";return isEmpty(e.items)&&isEmpty(t._items)?n+=" _empty":e.expanded&&(n+=" _expanded",t.D.ul||t._createChildNodes(e.items)),t.D.hand.className(n),t},selected:function(t,e){var n=this,i=n.tree();return n.opt("selected",t,function(){if(e!==!1){var o=i._selectedItems;t===!0?o.push(n):o.remove(o.indexOf(n))}n.D.anchor.toggleClass("selected",t)})},checked:function(t,e){var n=this;return n.opt("checked",t,function(){var i=n.tree(),o=i._checkedItems;n.D.checkbox.toggleClass("checked",t),e!==!1&&(t===!0?o.push(n):o.remove(o.indexOf(n))),"checkedItems"===i.selectionMode()&&n.selected(t),n._updateCheckBox(t),i.emit("itemChecked",t)})},insertTo:function(t,e){var i=this,o=i.opts,r=i.tree(),a=i.D.li=newDom("li","_container_li").data("node",i),s=r.selectionMode();return i._createNodeAnchor(),(o.selected||o.checked&&"checkedItems"===s)&&i.selected(!0),o.id&&o.tree&&o.tree.map(o.id,i),e===n||-1===e?t.append(a):isNumber(e)&&t.insert(a,e),i.update()},expand:Std.func(function(t){var e=this,n=e.opts,i=e.D;if(t===!0&&isEmpty(i.ul)&&n.items)if(isArray(n.items))e._createChildNodes(n.items),i.ul.hide();else if(isString(n.items)||isObject(n.items))return e._readJSON(i.hand,n.items,function(t){n.items=t,e.expand(!0)});if(!isEmpty(i.ul)){var o=function(t){return(t/=2.5)>300?t=300:100>t&&(t=100),t};if((n.expanded=t)===!0){var r=i.ul.show().offsetHeight(),a=i.ul.width();i.ul.css({width:a,height:0,opacity:.5,overflow:"hidden"}).animate("end").animate({50:{opacity:1},to:{opacity:1,height:r}},o(r),function(){i.ul.removeStyle("overflow width height opacity")})}else i.ul.css({width:i.ul.width(),overflow:"hidden",opacity:1}).animate("end").animate({to:{height:0,opacity:.5}},o(i.ul.offsetHeight()/2.5),function(){i.ul.removeStyle("overflow width height opacity").hide()});i.hand.toggleClass("_expanded",t)}}),add:function(t){var e=this,n=e.opts,i=e.D,o=e._createChildNode(t);return n.items||(n.items=[]),n.items.push(t),isEmpty(i.ul)||e._items.push(o.insertTo(i.ul)),o},append:function(t){var e=this;return isArray(t)?Std.each(t,function(t,n){e.add(n)}):e.add(t),e.update()},insertBefore:function(t,e){var n,i=this,o=i.opts.items;return o&&-1!==(n=o.indexOf(e))&&i.insert(t,n),i},insertAfter:function(t,e){var n,i=this,o=i.opts.items;return o&&-1!==(n=o.indexOf(e))&&i.insert(t,n+1),i},insert:function(t,e){var i=this,o=i.opts,r=i.D,a=i._createChildNode(t);return o.items||(o.items=[]),e===n?i.add(t).update():(isObject(e)&&(e=i._items.indexOf(e)),isNumber(e)&&(o.items.insert(t,e),isEmpty(r.ul)||i._items.insert(a.insertTo(r.ul,e),e)),i.update())},remove:function(t){var e=this,i=e.opts,o=e.tree();if(t===n){var r=i.parent._items,a=r.indexOf(e);-1!==a&&r.remove(a),i.id&&delete o._IDMap[i.id],e.D.li.remove(),e.update()}}},main:function(t,e){this.D={},this._items=[],this.init_opts(e),this.opts.tree=t}});return{parent:"widget",events:"clear selectionModeChange itemPositionChange dataSourceLoad itemClick itemDblClick itemRename itemChecked",option:{defaultClass:"StdUI_Tree",level:4,items:null,lines:!1,expanded:!1,checkable:!1,editable:!1,droppable:!1,itemHeight:20,dataSource:null,itemContextMenu:null,selectionMode:"items"},extend:{render:function(){var t=this,e=t.opts;e.checkable&&t.initCheckboxEvents(),e.droppable&&t.initDroppableEvents(),t.initEvents(),t.initKeyboardEvents(),t.updateStyle()},remove:function(e){var i=this,o=i.opts;e!==n&&(isNumber(e)&&(o.items&&o.items.length>e&&o.items.remove(e),e=i._items[e]),isString(e)&&(e=i.map(e)),e instanceof t&&e.remove())}},"protected":{createTreeItem:function(e){var n=this,i=e.type;i&&i in n._types&&(e=n.makeNodeOption(i,e));var o=new t(n,e);return o.parent(n),o.checkable(n.opts.checkable),o},makeNodeOption:function(t,e){var n=this,i=n._types[t];for(var o in i)o in e||(e[o]=i[o]);return e},anchorMouseEvents:function(t,e){var n=this,i=t.parent(),o=i.data("node"),r=n.selectionMode();t.mouse({auto:!1,click:function(t){n.emit("itemClick",[o,t],!0)},dblclick:function(t){n.editable()?n.editNode(o):o.expand(!o.expanded()),n.emit("itemDblClick",[o,t],!0)},down:function(t){"item"==r?(n.clearSelected(),o.selected(!0),t.stopPropagation()):"items"==r&&(t.ctrlKey||n.clearSelected(),o.selected(!o.selected()))}},e)},editNode:function(t){if(t._editState)return this;var e=this,n=t.text(),i=null,o=newDom("input","_input").value(n).on("mousedown",function(t){t.stopPropagation()}),r=newDom("span").css({top:-99,font:o.css("font"),fontSize:o.css("fontSize"),position:"absolute",visibility:"hidden"});return t._editState=!0,r.appendTo(e[0]),t.D.text.hide(),t.D.anchor.append(o.width(r.text(n).width()).focus().on({mousedown:function(t){t.stopPropagation()},blur:function(){var i=o.value();t.text(i),t.D.text.show().text(i),Std.dom.united([r,o]).remove(),n!==i&&e.emit("itemRename",[t,i,n],!0),t._editState=!1},keydown:function(t){13===t.keyCode?o.blur():(clearTimeout(i),i=setTimeout(function(){o.width(r.text(o.value()).width())},1))}})),o.select(),e},initKeyboardEvents:function(){var t=this;return t[0].on("keydown",function(e){if(113===e.keyCode&&t.editable()){var n=t._selectedItems;!isEmpty(n)}}),t},initDroppableEvents:function(){var t=this,n=0,i=!1,o=null,r=null,a=null,s=null,l=!1,u=null,c=null,d=null,h=function(e){l=!1,t[0].append(u=newDiv("_position").opacity(.5)),Std.dom("body").append(a=r.clone().className("StdUI_Tree_CloneAnchor").css({top:e.pageY+10,left:e.pageX+10,opacity:.8,position:"absolute",zIndex:Std.ui.status.zIndex+1,width:r.width()}))},p=function(){a.remove(),u.remove(),s=r=a=u=d=null},m=function(t){l!==t&&u.visible(l=t)},f=function(e){var l="",p=e.pageY-c.y,f=t[0].scrollTop();return i===!1?(e.preventDefault(),h(e,i=!0)):(p<=o.y+5?(l="before",m(!0),u.top(o.y+f)):p>=o.y+t.itemHeight()?(l="after",m(!0),u.top(o.y+f+t.itemHeight()+4)):s.is(r)||(l="in",m(!1),u.top(o.y+f)),l!==d&&a.className("StdUI_Tree_CloneAnchor _"+l),d=l,u.css({left:o.x,width:n,height:0}),a.css({left:e.pageX+10,top:e.pageY+10}),void 0)},v=function(e){var n=r.parent(),o=s.parent(),a=n.data("node"),l=o.data("node");if(!o.contains(e.target)&&!u.is(e.target)||n.contains(o))return i=!1,p();if(!r.is(s)){var c=a.index(),h=l.index();switch(a.parent()._items.remove(c),d){case"before":l.parent()._items.insert(a,h),a.parent(l.parent()),n.insertBefore(o);break;case"after":l.parent()._items.insert(a,h),a.parent(l.parent()),n.insertAfter(o);break;case"in":l.expanded()||l.expand(!0),a.parent(l),isEmpty(l.D.ul)&&l._createChildNodes(),l.D.ul.append(n),l._items.push(a)}t.emit("itemPositionChange",[a,l.update(),d],!(i=!1)),p()}};return t[0].on("mouseenter","li._container_li > a._anchor",function(a){s=this,n=s.outerWidth(),o=s.position(),c=t[0].offset(),!i&&this.mouse({auto:!1,up:function(t){Std.dom(e).off("mousemove",f),i&&v(t)},down:function(t){var n=t.target.nodeName;"IMG"===n&&t.preventDefault(),1===t.which&&"INPUT"!==n&&(s=r=this,Std.dom(e).on("mousemove",f))}},a)}),t},initContextMenu:function(){var t=this,n=t.opts,i=null,o=function(t){i[0].contains(t.target)||i.hide()};n.itemContextMenu&&t[0].on("contextmenu","li._container_li > a._anchor",function(r){var a=Std.plugin("contextMenu");i||(t.once("remove",function(){i.remove(),i=null,Std.dom(e).off("mousedown",o)}),i=Std.ui("Menu",Std.extend({renderTo:"body",visible:!1,css:{position:"absolute"}},n.itemContextMenu)),i.on("itemPress",function(){i.hide()}),Std.dom(e).on("mousedown",o)),i.show(),a.move(i,r.pageX,r.pageY,"body"),r.stopFire(),r.preventDefault()})},initCheckboxEvents:function(){var t=this;return t[0].on("mouseenter","i._checkbox",t._checkboxEvents=function(t){var e=this.parent("li._container_li"),n=e.data("node");this.mouse({auto:!1,click:function(){n.checked(!n.checked())},dblclick:function(t){t.stopPropagation()}},t)}),t},initEvents:function(){var t=this;return t[0].unselect(!0).on("mouseenter","i._hand",function(t){var e=this.parent(),n=e.data("node");this.mouse({auto:!1,click:function(){n.expand(!n.expanded())}},t)}).on("mouseenter","li._container_li > a._anchor",function(e){t.anchorMouseEvents(this,e)}),t},updateStyle:function(){var t=this,e={},n=t.itemHeight();return e[".StdUI_Tree.StdUI_"+t.objectName]={">":{"ul > li._container_li":{marginLeft:0}}," ":{"input._input":{height:n-2+"px",lineHeight:n-2+"px"},"i._checkbox":{margin:(n-16)/2+"px"},"i._hand":{margin:(n-12)/2+2+"px"},"i._icon":{width:n-2+"px",height:n-2+"px"},"li._container_li":{marginLeft:n+"px"},"a._anchor":{height:n+"px",lineHeight:n+"px"}}},t._CSSStyle.clear().append(e),t},updateLines:function(){}},"public":{selectionMode:function(t){return this.opt("selectionMode",t,function(){this.emit("selectionModeChange",t)})},editable:function(t){return this.opt("editable",t)},itemHeight:function(t){return this.opt("itemHeight",t,function(){this.renderState&&this.updateStyle()})},dataSource:function(t){return this.opt("dataSource",t,function(){this.reload()})},checkable:function(t){return this.opt("checkable",t,function(){t!==!0||isFunction(this._checkboxEvents)||this.initCheckboxEvents()})},expandAll:function(){var t=this;return Std.each(t._items,function(t,e){e.expandAll()}),t},collapseAll:function(){var t=this;return Std.each(t._items,function(t,e){e.collapseAll()}),t},lines:function(t){return this.opt("lines",t,function(){this.updateLines()})},map:function(t,e){var i=this,o=i._IDMap;if(t===n)return o;if(isFunction(t))Std.each(o,function(e,n){t(e,n)});else{if(e===n)return o[t];o[t]=e}return i},count:function(){var t=this,e=t.opts;return t._items?t._items.length:e.items?e.items.length:0},types:Std.func(function(t,e){var i=this,o=i._types;return isString(t)&&e===n?o[t]:(o[t]=Std.extend({},e),void 0)},{each:[isArray,isObject]}),insertBefore:function(t,e){var n=this,i=n.createTreeItem(t),o=n._items.indexOf(e);return i.insertTo(n[1],o),n._items.insert(i,o),n},insertAfter:function(t,e){var n=this,i=n.createTreeItem(t),o=n._items.indexOf(e);return-1!==o&&o++,i.insertTo(n[1],o),n._items.insert(i,o),n},insert:function(t,e){var i=this,o=i.createTreeItem(t);if(e===n)o.insertTo(i[1]),i._items.push(o);else if(isNumber(e))o.insertTo(i[1],e),i._items.insert(o,e);else if(isObject(e)){var r=i._items.indexOf(e);-1===r?(o.insertTo(i[1]),i._items.push(o)):(o.insertTo(i[1],r),i._items.insert(o,r))}return i},append:Std.func(function(t){this.insert(t)},{each:[isArray]}),reload:function(t){var e=this,n=e.opts,i=n.dataSource,o=i.read;return i&&"ajax"===i.type&&isObject(o)&&Std.ajax.json({url:o.url,data:Std.extend(o.data||{},t),type:o.type||"get",success:function(t){e.clear(),e.append(Std.mold.dataPath(t,o.dataPath)),e.emit("dataSourceLoad",t)}}),e},clearSelected:function(t){var e=this;return t===n&&(Std.each(e._selectedItems,function(t,e){e.opts.selected=!1,e.D.anchor.removeClass("selected")}),e._selectedItems.clear()),e},clearChecked:function(t){var e=this;return t===n&&(Std.each(e._checkedItems,function(t,e){e.opts.checked=!1,e.D.checkbox.removeClass("checked")}),e._checkedItems.clear()),e},clear:function(){var t=this;return t[1].clear(),t._items.clear(),t.clearChecked(),t.clearSelected(),Object.clear(t._IDMap),t.emit("clear")}},main:function(t,e){t[0].addClass("StdUI_"+t.objectName).append(t[1]=newDom("ul","_container_ul")),t._types={},t._items=[],t._IDMap={},t._checkedItems=[],t._selectedItems=[],t._CSSStyle=new Std.css,e.types&&t.types(e.types),e.items&&t.append(e.items),t.call_opts({dataSource:null},!0),t.initContextMenu()}}}),Std.ui.module("DataGrid",function(){var t="rowNumbers",i="rowCheckable",o="mouseenter",r="selected";return{parent:"widget",events:"clear selectionModeChange cellChange columnClick rowClick cellClick columnDblClick rowDblClick cellDblClick columnDropStart columnDropStop removeColumn removeRow updateRow dataSourceLoad",option:{level:4,height:300,minWidth:120,minHeight:60,headerHeight:29,headerVisible:!0,columnWidth:80,columnResizable:!0,columnSortable:!1,columnTextAlign:"left",columnDroppable:!0,columnEditable:!1,rowHeight:32,rowEditable:!1,rowNumbers:!1,rowCheckable:!1,rowCheckboxWidth:40,rowCollapsible:!1,cellPadding:3,cellEditable:!1,cellBorder:!0,cellTextAlign:"left",cellDroppable:!1,contextMenu:null,stripeRows:!1,hoverMode:"row",selectionMode:"row",items:null,columns:null,dataSource:null,value:null,valueFormat:"auto",boxSizing:"border-box",defaultClass:"StdUI_DataGrid"},"private":{rowCount:0,columnCount:0,rowNumbersWidth:0,selectedColumn:null,selectedRow:null,selectedRowIndex:null,selectedCell:null,columnPositions:null,lastRowBlock:null,sortHandle:null,cellWidgets:null,startAt:0,checkboxInit:!1},extend:{render:function(){var t=this;t.updateRowBlocks(),t.repaint(),t.updateStyle(),t.initEvents(),t.call_opts({contextMenu:null},!0)},height:function(t){var e=this,n=e.opts,i=e.boxSize;isNumber(t)||(t=e.height()),e[1].height(n.headerHeight),e[2].height(t-i.height-n.headerHeight-1),e.renderState&&e.refresh()},remove:function(t){var e=this;t===n&&e._CSSStyle.remove(),e.clear()}},"protected":{initHeader:function(){var t=this,e=t.opts;return t[0].append(t[1]=newDiv("_header").append(t.D.columns=newDiv("_columns"))),null!==e.columns&&t.appendColumn(e.columns),t},initBody:function(){var t=this;return t[0].append(t[2]=newDiv("_body")),t},initColumnPositions:function(){var t=this,e=t.opts;t._columnPositions=[];for(var n=0,i=t._columns.length,o=0;i>n;n++){var r=t._columns[n];t._columnPositions.push({begin:o,end:o=isNumber(r.width)?o+r.width:o+e.columnWidth})}return t._columnPositions},initScrollEvent:function(){var t=this,e=null;return t[2].on("scroll",function(){t[1].css("left",-this.scrollLeft())}),t[2].on("scroll",function(){null!==e&&clearTimeout(e),e=setTimeout(function(){t.repaint(),e=null},5+Math.ceil(t._rowCount/5e3))}),t},initColumnResizeEvent:function(t){var n=this,i=t.offset(),o=newDiv("_resizer").appendTo(n[0]).css({left:t.position().x-n[2].scrollLeft(),width:t.offsetWidth(),height:n.height()}),r=function(t){o.width(t.pageX-i.x+2)};return Std.dom(e).on("mousemove",r).once("mouseup",function(){var e=o.outerWidth(),i=t.index()-n._startAt;this.off("mousemove",r),n._columns[i].resizable!==!1&&(n._columns[i].width=e,n.updateStyle().refresh()),o.remove()}),n},initColumnDropHandle:function(t){var e=this,n=e.opts;return newDiv().css({position:"absolute",cursor:"move",zIndex:Std.ui.status.zIndex+1,border:"1px solid "+t.css("border-right-color"),paddingLeft:n.cellPadding+3,outerWidth:t.outerWidth()+1,outerHeight:t.outerHeight()+2,lineHeight:t.height(),background:e[1].css("background-color"),color:t.css("color"),fontSize:t.css("font-size"),textAlign:n.columnTextAlign}).html(t.html()).appendTo("body")},initColumnDropEvent:function(t){var n=this,i=n.opts,o=0,r=0,a=0,s=t.index()-n._startAt,l=t.offset(),u=!1,c=null,d=0,h=n._columnPositions=n.initColumnPositions(),p=null,m=function(e){u=!0,c=n.initColumnDropHandle(t),o=l.x-e.pageX-1,r=l.y-e.pageY-1,d=n[1].offset(),a=t.outerWidth(),d.x+=Std.dom(n._columns[0].element).position().x,n.emit("columnDropStart",[e.pageX,e.pageY],!0)},f=function(t){return!(t.pageX+o+a<d.x||t.pageX+o>d.x+n.width()||t.pageY+r+i.headerHeight<l.y||t.pageY+r>d.y+i.headerHeight)},v=function(t){for(var e=0,n=t.pageX+o+a/2,i=h.length;i>e;e++){var r=h[e].begin,s=h[e].end,l=d.x;if(l>n&&t.pageX+o+a>l)return 0;if(n>=l+r&&l+r+(s-r)/2>=n)return e;if(n>=l+r&&l+s>=n&&n>=l+r+(s-r)/2)return++e;if(e===i-1&&t.pageX+o<=l+s)return++e}return-1},g=function(t){if(0==u&&m(t),f(t)){var e=v(t);-1!==e&&e!=p&&n.showColumnDropPosition(p=e)}else n.hideColumnDropPosition();c.css({left:t.pageX+o,top:t.pageY+r}),t.preventDefault()},_=function(){c.animate("end").animate({to:{left:l.x,top:l.y,opacity:.5}},300,function(){c.remove(),c=null})};Std.dom(e).on("mousemove",g).once("mouseup",function(t){if(null!==c)if(f(t)){var e=v(t);-1!==e&&e!==s&&n.moveColumn(s,e),c.remove(),c=null}else _();this.off("mousemove",g),n.emit("columnDropStop",[t.pageX,t.pageY],!0).updateStyle(),n.hideColumnDropPosition()})},initCheckbox:function(){var t=this;return t.D.columns.on(o,"._defColumn._rowCheckbox>._checkbox",function(e){var n=this.mouse({auto:!1,click:function(){for(var e=!n.hasClass("checked"),i=0,o=t._rows.length;o>i;i++)t._rows[i].checked=e;n.toggleClass("checked",e),t.refresh()}},e)}),t[2].on(o,"._block>._row>._defCell._rowCheckbox>._checkbox",function(e){var n=this,i=n.parent(),o=i.parent(),a=t.computeRowIndexByCell(i),s=t._rows[a];n.mouse({auto:!1,click:function(){n.toggleClass("checked",s.checked=!s.checked),"checkedRows"===t.selectionMode()&&(s.checked?t.selectRow(a,i.parent()):(o.removeClass(r),delete t._selectedRow[a]))}},e)}),t._checkboxInit=!0,t},initHeaderEvents:function(){var t=this,e=t.opts,n=function(n){var i=this.index()-t._startAt;this.mouse({auto:!1,dblclick:function(){e.columnEditable&&t.editColumn(this),t.emit("columnDblClick",i)},down:function(n){var o=e.selectionMode;e.columnDroppable&&1==n.which&&(t.initColumnDropEvent(this),n.preventDefault()),"column"===o&&(t.clearSelected(o),t.selectColumn(i))},click:function(){if(!(0>i)){var n=t._columns[i].sortType;switch(n){case"asc":n="desc";break;case"desc":n="asc";break;default:n="asc"}e.columnSortable&&t.sortColumn(i,n),t.emit("columnClick",i)}}},n)};return t.D.columns.on(o,"._column",n).delegate(o,"._column > ._resizeHandle",function(n){t.enable()&&e.columnResizable&&this.mouse({auto:!1,unselect:!0,down:function(){return t.initColumnResizeEvent(this.parent()),!1}},n)}),t},initCellEvents:function(){var t=this,e=t.opts,n=function(e){this.hasClass(r)?e in t._selectedCell&&(this.removeClass(r),delete t._selectedCell[e]):t.selectCell(e,this)};return t[2].delegate(o,"._block > ._row > ._cell",function(i){if(t.enable())var o=null,r=-1,a=-1,s=-1,l=e.selectionMode,u=null,c=this.mouse({auto:!1,classStatus:"cell"===e.hoverMode,click:function(){t.emit("cellClick",u)},dblclick:function(n){var i=t.column(r).type;if(r>=0&&e.cellEditable&&"widget"!==t.column(r).type){var o=t.queryRowByIndex(10*s+a);t.editCell(this,i,t.queryCellByIndex(o,r),function(e){t.updateCellByIndex(o,r,e),t.emit("cellChange",[u,e],!0),t.refresh()})}t.emit("cellDblClick",u),n.preventDefault()},down:function(e){o=c.parent(),r=c.index()-t._startAt,a=o.index(),s=o.parent().index(),u=sprintf("%d:%d",10*s+a,r),"cells"===l&&e.ctrlKey?("cells"===l&&1===e.which&&(e.preventDefault(),t.cellsSelectStart(this,s,a,r)),n.call(this,u)):("cells"===l||"cell"===l)&&(t.clearSelected("cell"),t.selectCell(u,this))}},i)}),t},initRowEvents:function(){var t=this,e=t.opts,n=function(e){if(this.hasClass(r)){var n=t.rowIndex(e);t._selectedRow[n]&&(this.removeClass(r),delete t._selectedRow[n])}else t.selectRow(e,this)};return t[2].delegate(o,"._block > ._row",function(i){if(t.enable())var o,r,a,s=e.selectionMode,l=this.mouse({auto:!1,classStatus:"row"===e.hoverMode,click:function(){t.emit("rowClick",a)},dblclick:function(){t.emit("rowDblClick",a)},down:function(e){o=l.index(),r=l.parent().index(),a=sprintf("%d:%d",r,o),"rows"===s&&e.ctrlKey?(1===e.which&&(e.preventDefault(),t.rowsSelectStart(l,r,o)),n.call(l,a)):("rows"===s||"row"===s)&&(t.clearSelected("row"),t.selectRow(a,l))}},i)}),t},initBodyEvents:function(){var t=this;return t.initScrollEvent(),t.initRowEvents(),t.initCellEvents(),t},initCellWidgets:function(){var t=this;return Std.each(t._cellWidgets,function(t,e){e.renderState||e.render()}),t},initEvents:function(){var t=this;return t[0].focussing(function(){t.addClass("focus")},function(){t.removeClass("focus")}).mouse(),t.initHeaderEvents(),t.initBodyEvents(),t},showColumnDropPosition:function(t){var e=this,n=e.opts,i=e[1].offset(),o=i.x-6+t+(t===e._columns.length?e._columnPositions[t-1].end:e._columnPositions[t].begin),r=Std.ui.status.zIndex+1;return o+=e._columns[0].element.position().x,e.hideColumnDropPosition(),e.D.columnPos1=newDiv("StdUI_DataGrid_ColumnPosition _top").appendTo("body").css({top:i.y-12,left:o,zIndex:r}),e.D.columnPos2=newDiv("StdUI_DataGrid_ColumnPosition _bottom").appendTo("body").css({top:i.y+n.headerHeight,left:o,zIndex:r}),e},hideColumnDropPosition:function(){var t=this;return t.D.columnPos1&&t.D.columnPos1.remove(),t.D.columnPos2&&t.D.columnPos2.remove(),t},createRowHtml:function(t,e){var n=this.opts,i="",o="",r="_row",a=r+(n.stripeRows?" _odd":"");n.rowNumbers&&(o+="<div class='_defCell _rowNumber'></div>"),n.rowCheckable&&(o+="<div class='_defCell _rowCheckbox'></div>");for(var s=0;e>s;s++)o+="<div class='_cell _cell"+s+"'></div>";for(var l=0;t>l;l++)i+="<div class='"+(0==l%2?r:a)+"'>"+o+"</div>";return i},paintCell:function(t,e,n,i,o){var r=this,a=r.opts;switch(t.type){case"template":e.innerHTML=t.template.render(isObject(n)?n:{value:n});break;case null:case"text":isString(n)||isNumber(n)?e.innerHTML=n+"":isObject(n)&&(isWidget(n)||n.ui?Std.dom(e).widget(n):Std.dom(e).set(n));break;case"widget":if(Std.ui.exist(t.ui)){var s=Std.ui(t.ui,Std.extend({width:(t.width||a.columnWidth)-2*a.cellPadding,height:a.rowHeight-2*a.cellPadding,value:n},t.option));s.on("change",function(){s.renderState&&r.updateCellByIndex(i,o,s.value())}),r._cellWidgets.push(e.ui=s.appendTo(e))}}return e},paintRow:function(t,e,i,o){var r=this,a=r.opts,s=[],l=r._columns,u=o.cells;if(!isArray(u)&&isObject(u)){var c=new Array(r._columnCount),d=[];for(var h in u){var p=r.queryColumnIndexByName(h);-1!==p&&(c[p]=u[h],d[p]=l[p])}l=d,u=c}var m=i.childNodes;a.rowNumbers&&(m[0].innerHTML=t+1),a.rowCheckable&&(m[a.rowNumbers?1:0].appendChild(newDiv("_checkbox"+(o.checked?" checked":"")).dom),o.checked&&"checkedRows"===r.selectionMode()&&r.selectRow(t,Std.dom(i)));for(var f=0,v=m.length;v>f;f++)o&&u[f]!=n&&(s[f]=r.paintCell(l[f],m[r._startAt+f],u[f],o,f));return{row:i,cells:s,blockID:e}},editCell:function(t,e,n,i){var o=this,r=t.position(),a=t.text();"template"===e&&(isString(n)||isNumber(n)?a=n:isObject(n)&&"value"in n&&(a=n.value));var s=newDom("input","_input").value(a).on({blur:function(){var t=this.value();s.remove(),Std.func(i).call(o,t)},keypress:function(t){13===t.keyCode&&this.blur()}}).appendTo(this[2]).css({top:r.y+o[2].scrollTop(),left:r.x+o[2].scrollLeft(),outerWidth:t.outerWidth(),outerHeight:t.outerHeight()});return setTimeout(s.focus.bind(s.lineHeight(s.height())),10),o},editColumn:function(t){var e=this,n=t.position(),i=newDom("input","_input").value(t.text()).on({blur:function(){var n=this.value(),o=e._columns[t.index()];Std.dom("._client",t).html(o.text=n),i.remove()},keypress:function(t){13===t.keyCode&&this.blur()}}).appendTo(this[1]).css({top:n.y+e[1].scrollTop(),left:n.x+e[1].scrollLeft(),outerWidth:t.outerWidth(),outerHeight:t.outerHeight()});return setTimeout(i.focus.bind(i.lineHeight(i.height())),10),e},editRow:function(){var t=this;return t},rowsSelectStart:function(t,n,i){var a=this,s="._block > ._row",l={},u=function(){Std.each(l,function(t,e){t in a._selectedRow&&delete a._selectedRow[t],e.removeClass(r),delete l[t]});var t=this,e=t.index(),o=t.parent().index(),s=i,u=n;(u>o||o==u&&s>e)&&(e^=s,s^=e,e^=s,u^=o,o^=u,u^=o);for(var c=u;o>=c;c++){var d=Std.dom(a._rowBlocks[c]).children(),h=d.length,p=0,m=h-1;c===u?(p=s,u===o&&(m=e)):c===o&&(p=0,m=e);for(var f=p;m>=f;f++)l[10*c+f]=d[f]}Std.each(l,function(t,e){e.addClass(r)})};return Std.dom(e).once("mouseup",function(){Std.each(l,function(t,e){a.selectRow(~~t,e)}),a[2].off(o,s,u)}),a[2].delegate(o,s,u),a},cellsSelectStart:function(t,n,i,a){var s=this,l="._block > ._row > ._cell",u={},c=function(){Std.each(u,function(t,e){t in s._selectedCell&&delete s._selectedCell[t],e.removeClass(r),delete u[t]});var t=this,e=t.parent(),o=t.index(),l=e.index(),c=e.parent().index(),d=a,h=i,p=n;d>o&&(o^=d,d^=o,o^=d),(p>c||c==p&&h>l)&&(l^=h,h^=l,l^=h,p^=c,c^=p,p^=c);for(var m=p;c>=m;m++){var f=Std.dom(s._rowBlocks[m]).children(),v=f.length,g=0,_=v-1;m===p?(g=h,p===c&&(_=l)):m===c&&(g=0,_=l);for(var b=g;_>=b;b++)for(var w=f[b].children(),x=d;o>=x;x++)u[10*m+b+":"+x]=w[x]}Std.each(u,function(t,e){e.addClass(r)})};return Std.dom(e).once("mouseup",function(){Std.each(u,function(t,e){s.selectCell(t,e)}),s[2].off(o,l,c)}),s[2].delegate(o,l,c),s},updateRowBlocks:function(){for(var t=this,n=t._rowCount,i=t._rowBlocks,o=e.createDocumentFragment(),r=0,a=Math.ceil(n/10)-i.length;a>r;r++){var s=e.createElement("div");
s.className="_block _block"+r,o.appendChild(s),i.push(s)}t[2].dom.appendChild(o),null!==t._lastRowBlock&&Std.dom(t._lastRowBlock).removeStyle("height");var l=Std.dom(i[i.length-1]);return null!==l&&(t._lastRowBlock=l.height((t._rowCount-10*(i.length-1))*t.opts.rowHeight).dom),t},updateStyle:function(){var t=this,e=t.opts,n={},i=0,o=t.width()-t.boxSize.width,r=e.rowHeight-1,a=10*(r+1)+"px",s=r-2*e.cellPadding,l=e.columnWidth,u=e.headerHeight,c=t._rowNumbersWidth,d={"._defColumn":{height:u-1+"px"},"._column":{textAlign:e.columnTextAlign,height:u-1+"px",lineHeight:u-1+"px",">":{"._sortType":{marginTop:(u-7)/2+"px"}}}},h={"._cell":{padding:e.cellPadding+"px",height:s+"px",lineHeight:s+"px",textAlign:e.cellTextAlign}};e.rowNumbers&&(h["._defCell._rowNumber"]={height:e.rowHeight+"px",width:c+1+"px"},d["._defColumn._rowNumbers"]={height:u+"px",width:c+"px"},i+=c+2),e.rowCheckable&&(h["._defCell._rowCheckbox"]={height:e.rowHeight+"px",width:e.rowCheckboxWidth+1+"px"},d["._defColumn._rowCheckbox"]={width:e.rowCheckboxWidth+"px"},i+=e.rowCheckboxWidth+2);for(var p=0,m=t._columnCount;m>p;p++){var f=t._columns[p],v=(f.width||l)-1+"px";d["._column"+p]={width:v},h["._cell"+p]={width:(f.width||l)-2*e.cellPadding+"px"},i+=(f.width||l)+1}o>=i?i="100%":i+="px";var g={height:r+"px",lineHeight:r+"px",">":h};return n[".StdUI_DataGrid.StdUI_"+t.objectName]={">":{"._header":{">":{"._columns":{">":d}}},"._body":{">":{"._block":{width:i,height:a},"._block > ._row":g}}}},e.cellBorder===!1&&(h["._cell"].borderColor=g.borderColor="transparent"),t._CSSStyle.clear().append(n),t}},"public":{each:function(t,e){var n=this;return Std.each(n._rows,function(e,i){return isFunction(t)?t.call(n,e,i):void 0},e)},dataSource:function(t){return this.opt("dataSource",t,function(){this.reload()})},columnResizable:function(t){return this.opt("columnResizable",t)},selectionMode:function(t){return this.opt("selectionMode",t,function(){this.emit("selectionModeChange",t)})},valueFormat:function(t){return this.opt("valueFormat",t)},columnDroppable:function(t){return this.opt("columnDroppable",t)},columnSortable:function(t){return this.opt("columnSortable",t)},columnTextAlign:function(t){return this.opt("columnTextAlign",t,function(){this.updateStyle()})},row:function(t){return this.queryRowByIndex(t)},queryRowByIndex:function(t){return this._rows[this.rowIndex(t)]||null},queryRowByID:function(t){for(var e=this,n=e._rows,i=0,o=n.length;o>i;i++)if(n[i].ID===t)return n[i];return null},cell:function(t,e){return this.queryCellByIndex(t,e)},queryCellByColumnName:function(t,e){var i;if(isObject(t)?i=t.cells:(isNumber(t)||isString(t))&&null!==(t=this.queryRowByIndex(t))&&(i=t.cells),isArray(i)){var o=this.queryColumnIndexByName(e);if(-1!==o&&i[o]!==n)return i[o]}else if(isObject(i)&&i[e]!==n)return i[e];return null},queryCellByIndex:function(t,e){var i;if(isObject(t)?i=t.cells:(isNumber(t)||isString(t))&&null!==(t=this.queryRowByIndex(t))&&(i=t.cells),isArray(i)&&i[e]!==n)return i[e];if(isObject(i)){var o=this.queryColumnByIndex(e);if(o&&o.name&&i[o.name]!==n)return i[o.name]}return null},column:function(t){var e=this;return isNumber(t)?e.queryColumnByIndex(t):isString(t)?e.queryColumnByName(t):null},queryColumnByIndex:function(t){return this._columns[t]||null},queryColumnIndexByName:function(t){for(var e=0;e<this._columnCount;e++)if(t===this._columns[e].name)return e;return-1},queryColumnByName:function(t){var e=this.queryColumnIndexByName(t);return-1!==e?this._columns[e]:null},rowIndex:function(t){if(isString(t)){var e=(t=t.split(":")).length;1==e?t=~~t[0]:2==e&&(t=10*~~t[0]+~~t[1])}return t},computeRowIndexByCell:function(t){var e=t.parent();return 10*e.parent().index()+e.index()},headerVisible:function(t){var e=this;return e.opt("headerVisible",t,function(){e[1].visible(t)})},contextMenu:function(t){var e=this;return e.plugin("contextMenu",Std.extend({handle:e[2]},t)),e},stripeRows:function(t){return this.opt("stripeRows",t,function(){this.refresh()})},rowCheckable:function(e){var n=this,o=n._defColumns;return n.opt(i,e,function(){if(1!=e||o[i])0==e&&i in o&&(o[i]&&o[i].remove(),delete o[i],n._startAt--);else{var r=o[i]=newDiv("_defColumn _rowCheckbox").append(newDiv("_checkbox"));n._checkboxInit||n.initCheckbox(),n.rowNumbers()?n.D.columns.insertAfter(r,o[t]):n.D.columns.prepend(r),n._startAt++}n.renderState&&n.refresh().updateStyle()})},rowNumbers:function(e){var n=this,i=n._defColumns;return n.opt(t,e,function(){1!=e||i[t]?0==e&&t in i&&(i[t]&&i[t].remove(),n._startAt--,delete i[t]):(n.D.columns.prepend(i[t]=newDiv("_defColumn _rowNumbers")),n._startAt++),n.renderState&&n.refresh().updateStyle()})},selectRow:function(t,e){var i=this,o=-1,a=i._selectedRow;return t===n?a:(o=isString(e)&&t===n?i.rowIndex(e):isString(t)?i.rowIndex(t):isNumber(e)?e:t,isObject(e)||(e=i._rowBlocks[Math.floor(o/10)].children(o%10)),!e||o in a||(a[o]=e.addClass(r)),i)},selectedRow:function(){var t=this,e=t._selectedRow,n=t.selectionMode();if("row"==n)for(var i in e)return i;else if("rows"==n){var o=[];for(var i in e)o.push(i);return o}return null},selectCell:function(t,e){var i=this,o=i._selectedCell,a=-1;if(t===n){if("cell"==i.selectionMode())for(var s in o)return o[s];return o}if(isString(t)&&(a=t.split(":")),!isObject(e)){var l=i._rowBlocks[Math.floor(a[0]/10)].children(a[0]%10);e=l.children(a[1])}return!e||t in o||(o[t]=e.addClass(r)),i},selectedCell:function(){var t=this,e=t._selectedCell,n=t.selectionMode();if("cell"==n)for(var i in e)return e[i];else if("cells"==n){var o=[];for(var i in e)o.push(i);return o}return null},selectColumn:function(t){var e=this,n=e._columns,i=e._selectedColumn;return t in i||(i[t]=n[t],i[t].element.addClass(r)),e},updateCellByColumnName:function(t,e,i){var o;if(isObject(t)?o=t.cells:(isNumber(t)||isString(t))&&null!==(t=this.queryRowByIndex(t))&&(o=t.cells),isArray(o)){var r=this.queryColumnIndexByName(e);-1!==r&&o[r]!==n&&(o[r]=i)}else isObject(o)&&o[e]!==n&&(o[e]=i);return this},updateCellByIndex:function(t,e,i){var o;if(isObject(t)?o=t.cells:(isNumber(t)||isString(t))&&null!==(t=this.queryRowByIndex(t))&&(o=t.cells),isArray(o)&&o[e]!==n)o[e]=i;else if(isObject(o)){var r=this.queryColumnByIndex(e);r&&r.name&&o[r.name]!==n&&(o[r.name]=i)}return this},updateRowByIndex:function(t,e){var n=this,i=n._rows;if(isNumber(t)||isString(t))-1!==(t=n.rowIndex(t))&&(i[t]=e);else if(isObject(t))for(var o in t)-1!==(o=n.rowIndex(o))&&(i[o]=t[o]);return n},updateRowByID:function(t,e){var n=this,i=n._rows,o=function(t,e){for(var o=0,r=n._rowCount;r>o;o++)if(i[o].ID===t){i[o]=e;break}};if(isNumber(t)||isString(t))o(t,e);else if(isObject(t))for(var r in t)o(r,t[r]);return n},value:function(t){var e=this,i=e.valueFormat();if(t!==n)return e;for(var o=null,r=0;r<e._rowCount;r++){var a=e._rows[r];o||("auto"==i?o||(o="ID"in a?{}:[]):"array"==i?o=[]:"object"==i&&(o={})),isArray(o)?o.push(a.cells):isObject(o)&&"ID"in a&&(o[a.ID]=a.cells)}return o},mergeCells:function(){var t=this;return t},moveColumn:function(t,e){var n=this,i=n._columns;e===i.length?i[t].element.insertAfter(i[e-1].element):i[t].element.insertBefore(i[e].element),i.move(t,e>t?--e:e);for(var o=0;o<n._rowCount;o++){var r=n._rows[o].cells;isArray(r)&&r.move(t,e)}return n.resetColumnClass().refresh()},swapColumn:function(t,e){var n=this,i=n._columns;i[t].element.swap(i[e].element),i.swap(t,e);for(var o=0;o<n._rowCount;o++){var r=n._rows[o].cells;isArray(r)&&r.swap(t,e)}return n.resetColumnClass().refresh()},insertColumn:function(t,e){var i=this,o="",r=newDiv("_column _column"+i._columnCount),a=i._columns;isString(t)?o=t:isObject(t)&&(o=t.text||"column"+i._columnCount);var s={text:o,element:r.append([newDiv("_client").html(o),newDiv("_resizeHandle")])};return Std.each("ui name type width option template resizable",function(e,i){s[i]=t[i]===n?null:t[i]}),null!=e&&e<i._columnCount?(a.insert(s,e),i.D.columns.insert(r,e)):(i.D.columns.append(r),a.push(s)),i._columnCount++,i.renderState&&i.updateStyle(),i},sortColumn:function(t,e){var n=this,i=n._columns[t],o=function(t,e){return isArray(t)?e:i.name};return null!==n._sortHandle&&n._sortHandle.remove(),"desc"===e?n._rows.sort(function(e,n){return e.cells[o(e.cells,t)]<n.cells[o(n.cells,t)]}):"asc"===e&&n._rows.sort(function(e,n){return e.cells[o(e.cells,t)]>n.cells[o(n.cells,t)]}),i.sortType=e,i.element.append(n._sortHandle=newDiv("_sortType"+(e?" _"+e:""))),n.refresh()},appendColumn:Std.func(function(t){return this.insertColumn(t)},{each:[isArray]}),insertRow:Std.func(function(){},{each:[isArray]}),appendRow:function(t){var e=this;return isArray(t)?(e._rows.mergeArray(t),e._rowCount+=t.length):isObject(t)&&"cells"in t&&(e._rows.push(t),e._rowCount++),e.renderState&&e.refresh(),e},resetColumnClass:function(t){for(var e=this,n=e._columns,i=t||0,o=n.length;o>i;i++)n[i].element.className("_column _column"+i);return e},refresh:function(){var t=this;return t.clearCellWidgets(),t.clearRowBlocks(),t.updateRowBlocks(),t.repaint()},reload:function(t){var e=this,n=e.opts,i=n.dataSource,o=i.read;return i&&"ajax"===i.type&&isObject(o)&&Std.ajax.json({url:o.url,data:Std.extend(o.data||{},t),type:o.type||"get",success:function(t){e.clear(),e.appendRow(Std.mold.dataPath(t,o.dataPath)),e.emit("dataSourceLoad",t)}}),e},repaint:function(){for(var t=this,e=t.opts,n=t[2].dom.scrollTop,i=10*e.rowHeight,o=Math.floor(n/i),r=Math.ceil((t.height()-t.boxSize.height-e.headerHeight-1)/i+n/i%1),a=0,s=0;r>s;s++){var l=o+s,u=t._rowBlocks[l];if(u&&0===u.childNodes.length){for(var c=u===t._lastRowBlock?t._rowCount-10*l:10,d=t.createRowHtml(c,t._columnCount),h=Std.dom.fragment(d),p=0,m=h.childNodes,f=m.length;f>p;p++)t.paintRow(10*l+p,l,m[p],t._rows[a=10*l+p]);u.appendChild(h)}}if(e.rowNumbers){var v=newDom("span","_tester").html(t._rowCount).appendTo(t);(t._rowNumbersWidth=v.width()+10)<30&&(t._rowNumbersWidth=30),v.remove()}return t.initCellWidgets()},clearSelected:Std.func(function(t){var e=this;switch(t){case n:e.clearSelected("column row cell");break;case"column":Std.each(e._selectedColumn,function(t,n){n.element.removeClass(r),delete e._selectedColumn[t]});break;case"row":Std.each(e._selectedRow,function(t,n){n.removeClass(r),delete e._selectedRow[t]});break;case"cell":Std.each(e._selectedCell,function(t,n){n.removeClass(r),delete e._selectedCell[t]})}},{each:[isArray,isString]}),removeColumn:function(t){var e=this,n=e._columns;if(isString(t)&&(t=e.queryColumnIndexByName(t)),isNumber(t)&&e._columnCount>t&&t>=0){for(var i=n[t],o=n.indexOf(i),r=0;r<e._rowCount;r++){var a=e._rows[r].cells;isArray(a)?a.remove(o):isObject(a)&&delete a[i.name]}i.element.remove(),n.remove(o),e.resetColumnClass(t)}return e._columnCount=e._columns.length,e.refresh().emit("removeColumn",t)},removeRow:function(t){var e=this;if(isNumber(t)||isArray(t))e._rows.remove(t);else if("select"===t){var n=[];Std.each(e._selectedRow,function(t){n.push(~~t)}),e._rows.remove(n)}return e._rowCount=e._rows.length,e.refresh().emit("removeRow",t)},clear:function(){var t=this;return t._rowCount=0,t._rows.clear(),t.clearRowBlocks(),t.clearCellWidgets(),t.emit("clear")},clearCellWidgets:function(){var t=this;return Std.each(t._cellWidgets,function(t,e){e.remove()}),t._cellWidgets.clear(),t},clearRowBlocks:function(){var t=this;return t._lastRowBlock=null,t._rowBlocks.clear(),t.clearSelected(),t[2].clear(),t}},main:function(t,e){t.addClass("StdUI_"+t.objectName),t.D={},t._CSSStyle=new Std.css,t._rows=[],t._columns=[],t._rowBlocks=[],t._selectedColumn={},t._selectedRow={},t._selectedCell={},t._cellWidgets=[],t._defColumns={},t.initHeader(),t.initBody(),t.call_opts({rowNumbers:!1,rowCheckable:!1,dataSource:null},!0),isArray(e.items)&&(t._rows.mergeArray(e.items),t._rowCount+=e.items.length)}}}),Std.ui.module("TaskBarItem",{parent:"Item",events:"active select",option:{activated:!1,selected:!1,defaultClass:"StdUI_Item StdUI_TaskBarItem"},"public":{selected:function(t){var e=this;return e.opt("selected",t,function(){e[0].toggleClass("selected",t),e.emit("select",t),e.parent().emit("itemSelect",[t,e],!0)})},activated:function(t){var e=this;return e.opt("activated",t,function(){var n=e.parent();e[0].toggleClass("activated",t),e.emit("active",t),n.emit("itemActive",[t,e],!0),t===!1&&(e.selected()&&n.reselect(e),e[0].removeClass("hover"),e.selected(!1))})},updateStyle:function(t,e,n){var i=this;!i.iconHeight()!==e/2&&i.iconHeight(e/2).iconWidth(e/2),t!==i._spacing&&i[0].marginRight(i._spacing=t),i.height(e).width(n)}},main:function(t){t.call_opts({activated:!1,selected:!1},!0)}}),Std.ui.module("TaskBar",{parent:"widget",events:"itemClick itemActive itemSelect itemContextMenu",option:{level:3,defaultClass:"StdUI_TaskBar",items:null,height:35,spacing:8,minItemHeight:26,tabIndex:null,multiRow:!0,taskMenu:null},"private":{selectedItem:null},extend:{render:function(){var t=this;isEmpty(t._items)||(Std.each(t._items,function(t,e){e.render()}),t.update()),t.initEvents(),t.initDocEvents()},remove:function(t){var i=this,o=i._items;if(t===n)isWidget(i._taskMenu)&&i._taskMenu.remove(),i._docEvents&&Std.dom(e).off("mousedown",i._docEvents);else if(isNumber(t))i.reselect(o[t]),o[t].remove(),o.remove(t);else if(isWidget(t)){var r=o.indexOf(t);-1!==r&&(i.reselect(t),o[r].remove(),o.remove(r))}}},"protected":{reselect:function(t){for(var e=this,n=e._items,i=n.indexOf(t),o=n.length,r=-1,a=i+1;o>a;a++)if(n[a].activated()){r=a;break}if(-1==r)for(var a=i-1;a>=0;a--)if(n[a].activated()){r=a;break}return-1!==r&&(e._selectedItem=n[r].selected(!0)),e},itemClick:function(t,e){var n=this,i=e.index(),o=n._items[i];n.select(o,!o.selected()),n.emit("itemClick",[t,i,o],!0)},initDocEvents:function(){var t=this;Std.dom(e).on("mousedown",t._docEvents=function(e){t._taskMenu&&!t._taskMenu[0].contains(e.target)&&t._taskMenu.hide()})},initTaskMenu:function(){var t=this,e=t.opts;return t._taskMenu=isWidget(e.taskMenu)?e.taskMenu:Std.ui("Menu",e.taskMenu),isWidget(t._taskMenu)&&(t._taskMenu[0].css("position","absolute"),t._taskMenu.on({itemPress:function(){t._taskMenu.hide()}}).renderTo("body")),t},initEvents:function(){var e=this,n=e.opts;return e[0].on("contextmenu",function(t){t.preventDefault()}),e[0].on("mouseenter",">.StdUI_Item",function(){this.mouse({auto:!1,unselect:!0,click:function(t){return e.itemClick(t,this)}})}).on("contextmenu",">.StdUI_Item",function(i){if(!e._taskMenu&&isObject(n.taskMenu)&&e.initTaskMenu(),isWidget(e._taskMenu)){var o=e._taskMenu.show(),r=i.pageX,a=i.pageY,s=o.width(),l=o.height();r+s>Std.dom(t).width()&&(r=Std.dom(t).width()-s),o.toForeground()[0].css({top:a-l,left:r})}e.emit("itemContextMenu",[i,this.ui()],!0),i.preventDefault()}),e},createItem:function(t){var e=this,n=null;return isWidget(t)?n=t:isObject(t)?n=Std.ui(t.ui||"TaskBarItem",t||{}):(isString(t)||isNumber(t))&&(n=Std.ui("TaskBarItem",{text:t})),isWidget(n)&&(n.parent(e),n.verticalAlign("middle"),n.appendTo(e[0]),e.renderState&&n.render()),n},update:function(){var t=this,e=t.opts,n=t._items.length,i=t.width()-t.boxSize.width,o=t.height()-t.boxSize.height,r=e.spacing,a=5,s=200>i/a?i/(a=Math.floor(i/200)):i/a;return s*n>i&&(o/e.minItemHeight>=2&&e.multiRow?s*(o/=2)>=i&&n>=2*a&&(s=0==n%2?Math.floor(2*i/n):Math.floor(2*i/(n+1))):s=Math.floor((i-r)/n)),Std.each(t._items,function(t,e){e.updateStyle(r,o,s-r<o/2+e.boxSize.width?o/2+e.boxSize.width:s-r)}),t}},"public":{add:function(t){var e=this,n=e.createItem(t);return null!==n&&e._items.push(n),n},taskMenu:function(t){var e=this;return e.opt("taskMenu",t,function(){e._taskMenu&&(e._taskMenu.remove(),e._taskMenu=null)})},select:function(t,e){var n=this;if(isNumber(t)&&(t=n._items[t]),e===!0){if(n._selectedItem===t&&t.selected())return n;t.activated()||t.activated(!0),n._selectedItem&&n._selectedItem.selected(!1),n._selectedItem=t.selected(!0)}else t.activated()&&t.activated(!1),t.selected(!1),n.reselect(t);return n},append:function(t){var e=this;return isArray(t)?Std.each(t,function(t,n){e.add(n)}):e.add(t),e.renderState&&e.update(),e}},main:function(t,e){t._items=[],e.items&&t.append(e.items)}}),Std.ui.module("TrayItem",{parent:"widget",option:{tabIndex:null,defaultClass:"StdUI_TrayItem",icon:"",name:"",text:"",popup:null,contextMenu:null},extend:{remove:function(){var t=this,e=t.opts;isWidget(e.contextMenu)&&e.contextMenu.remove()}},"public":{name:function(t){return this.opt("title",t,function(){this._tooltipTitle&&this._tooltipTitle.html(t)})},text:function(t){return this.opt("text",t,function(){this._tooltipText&&this._tooltipText.html(t)})},icon:function(t){var e=this;return e.opt("icon",t,function(){e[1].attr("src",t),e._tooltipIcon&&e._tooltipIcon.attr("img",t)})},popup:function(t){var e=this,i=e.opts;return t===n?i.popup:(i.popup=!isWidget(t)&&isObject(t)?Std.ui(t.ui||"widget",t):t,e)},contextMenu:function(t){var e=this,i=e.opts;return t===n?i.contextMenu:(!isWidget(t)&&isObject(t)&&(t=Std.ui(t.ui||"Menu",t)),isWidget(t)&&t.on("itemPress",function(){t.hide()}),i.contextMenu=t,e)}},main:function(t){t[0].append(t[1]=newDom("img")),t.call_opts({icon:"",name:"",text:"",popup:null,contextMenu:null},!0)}}),Std.ui.module("Tray",{parent:"widget",events:"itemClick",option:{level:3,height:35,spacing:4,iconSize:22,defaultClass:"StdUI_Tray",value:null,tabIndex:null},"private":{timer:null,state:!1,iconViewInitialized:!1,iconViewVisibled:!1,contextMenu:null},extend:{beforeRender:function(){},height:function(){this.updateHeight()},render:function(){var t=this;t.update(),t.initEvents(),t.initDocEvents()},remove:function(t){var i=this,o=i._items;if(t===n)i._popup&&i._popup.remove(),i._tooltip&&i._tooltip.remove(),i._docEvent&&Std.dom(e).off("mousedown",i._docEvent),i[3]&&i[3].remove(),Std.each(o,function(t,e){e.remove()});else if(isNumber(t))t<o.length&&(o[t].remove(),o.remove(t),i.update());else if(isWidget(t)){var r=o.indexOf(t);-1!==r&&(o[r].remove(),o.remove(r),i.update())}}},"protected":{initDocEvents:function(){var t=this;Std.dom(e).on("mousedown",t._docEvent=function(e){var n=e.target;if(!(t._contextMenu&&t._contextMenu[0].contains(e.target)||(t.hideContextMenu(),t[0].contains(n)||t[3]&&t[3].contains(n)))){if(t._popup){if(t._popup.contains(n))return;t.hidePopup()}if(t._tooltip){if(t._tooltip.contains(n))return;t.hideToolTip()}}})},createPopup:function(){var t=this;return t._popup&&t._popup.remove(),t._popup=newDiv("Tray_Popup").append([t._popupTitle=newDiv("_title"),t._popupMain=newDiv("_main")]).appendTo("body"),t},createToolTip:function(){var t=this,e=t.opts,n=1.5*e.iconSize;return t._tooltip&&t._tooltip.remove(),t._tooltip=newDiv("Tray_ToolTip").append([t._tooltipIcon=newDom("img","_icon").height(n).width(n),newDiv("_main").append([t._tooltipTitle=newDiv("_title"),t._tooltipText=newDiv("_text")])]).appendTo("body"),t},trayItemEvents:function(t,e){var n=this;clearTimeout(n._timer),n._state===!1?(n._state=!0,n._timer=setTimeout(function(){n.showToolTip(t)},800)):n.showToolTip(t),t[0].mouse({auto:!1,leave:function(){clearTimeout(n._timer),n._timer=setTimeout(function(){n.hideToolTip()},100)},down:function(){n._state=!1,clearTimeout(n._timer)},click:function(e){t.opts.popup?n.showPopup(t):n._popup&&n._popup.visible()&&n.hidePopup(),n.emit("itemClick",[e,t],!0)}},e)},initEvents:function(){var t=this;return t[0].on("mouseleave",function(){t._state=!1}).on("contextmenu",function(t){t.preventDefault()}).on("mouseenter",">.StdUI_TrayItem",function(e){return t.trayItemEvents(this.ui(),e)}).on("contextmenu",".StdUI_TrayItem",function(e){t.showContextMenu(this.ui(),e)}),t[2].on("click",function(){t._iconViewVisibled?t.hideIconView():t.showIconView()}),t},initIconView:function(){var t=this;return t._iconViewInitialized||(t[3]=newDiv("StdUI_Tray-iconView").appendTo("body"),t._iconViewInitialized=!0),t[3].on("mouseleave",function(){t._state=!1}).on("contextmenu",function(t){t.preventDefault()}).on("mouseenter",">.StdUI_TrayItem",function(e){return t.trayItemEvents(this.ui(),e)}).on("contextmenu",".StdUI_TrayItem",function(e){t.showContextMenu(this.ui(),e)}),t},updateHeight:function(){var t=this,e=t.height()-t.boxSize.height;return t[2].marginTop((e-t[2].height())/2),t},update:function(){var t=this,e=t.opts,n=t.width()-t.boxSize.width,i=t.height()-t.boxSize.height,o=t.iconSize(),r=Math.floor(i/(o+4)),a=Math.floor(n/(o+4)),s=0;return t._items.length<=a*r?(t[2].hide(),t[1].removeStyle("width")):(t[2].show(),a=Math.floor((n-=t[2].width())/(o+4)),t[1].width(n)),Std.each(t._items,function(n,i){return n>=a*r?(t._iconViewInitialized||t.initIconView(),i[0].css("marginRight",e.spacing).appendTo(t[3]),void 0):(0===n+1%a&&s++,s>0&&r>s&&i[0].css("marginBottom",e.spacing),i[0].show().css("marginRight",e.spacing),i.appendTo(t[1]),i.renderState||i.render(),void 0)}),t[1].css("marginTop",(i-t[1].height())/2),t.updateIconViewHeight()},updateIconViewHeight:function(){var t=this;if(t[3]&&t[3].visible()){var e=t[0].offset(),n=t[3].removeStyle("height").outerHeight();0==t[3].height()?t.hideIconView():t[3].animate("end").animate({to:{top:e.y-n,outerHeight:n}},100)}}},"public":{showPopup:function(e){var n=this,i=n[0].offset(),o=e.popup();n._popup||n.createPopup(),isWidget(o)?(n._popupMain.clear(),n._popupMain.append(o),o.renderState||o.render()):(isString(o)||isNumber(o))&&n._popupMain.html(o),n._popupTitle.html(e.name()),n._popup.show();var r=i.x+(n.width()-n._popup.outerWidth())/2,a=i.y-n._popup.offsetHeight()-5;return 0>r?r=0:r+n._popup.offsetWidth()>Std.dom(t).width()&&(r=Std.dom(t).width()-n._popup.offsetWidth()),n._popup.css({top:a,left:r,zIndex:++Std.ui.status.zIndex}),n.hideToolTip().hideIconView()},hidePopup:function(){var t=this;return t._popup&&t._popup.hide(),t},updateToolTip:function(t,e,n){var i=this;return i._tooltipIcon.attr("src",t),i._tooltipTitle.html(e),i._tooltipText.html(n),i},showToolTip:function(e){var n=this,i=e[0].offset(),o=e.icon(),r=e.name(),a=e.text();n._tooltip?(n.updateToolTip(o,r,a),n._tooltip.show()):(n.createToolTip(),n.updateToolTip(o,r,a),n._tooltip.css({top:i.y-n._tooltip.offsetHeight()-5,left:0,visibility:"hidden"}));var s=i.x-(n._tooltip.offsetWidth()-e.width())/2,l=i.y-n._tooltip.offsetHeight()-5;return 0>s?s=0:s+n._tooltip.offsetWidth()>Std.dom(t).width()&&(s=Std.dom(t).width()-n._tooltip.offsetWidth()),0>l&&(l=i.y+n.height()),"hidden"===n._tooltip.css("visibility")&&n._tooltip.removeStyle("visibility").css("left",s),n._tooltip.css("zIndex",++Std.ui.status.zIndex).animate("end").animate({to:{top:l,left:s}},100),n},hideToolTip:function(){var t=this;return t._tooltip&&t._tooltip.hide(),t},showIconView:function(){var t=this,e=t[0].offset();t._iconViewInitialized||t.initIconView(),Std.each(t._items,function(t,e){!e.renderState&&e.render()}),t[3].removeStyle("height").show().css({outerWidth:t.width(),top:e.y-t[3].boxSize().height,left:e.x});var n=t[3].outerHeight();return t[2].addClass("_visibled"),t[3].height(0).animate("end").animate({to:{top:e.y-n,outerHeight:n}},100),t._iconViewVisibled=!0,t.hidePopup()},hideIconView:function(){var t=this;return t[2]&&t[3]&&(t[2].removeClass("_visibled"),t[3].animate("end").animate({to:{top:t[0].offset().y-t[3].boxSize().height,height:0}},100,function(){t[3].hide()}),t._iconViewVisibled=!1),t},showContextMenu:function(e,n){var i=this,o=e.contextMenu();if(o){o.renderState||(o[0].css("position","absolute"),o.renderTo("body")),o.show();var r=n.pageX,a=n.pageY-o.height();r+o.width()>Std.dom(t).width()&&(r=Std.dom(t).width()-o.width()),0>a&&(a=n.pageY),i._contextMenu=o.move(r,a),i.hideToolTip()}},hideContextMenu:function(){var t=this;return t._contextMenu&&t._contextMenu.hide(),t},iconSize:function(t){var e=this;return e.opt("iconSize",t,function(){Std.each(e._items,function(n,i){e[2].height(t).width(t),i.width(t).height(t)}),e.updateHeight()})},add:function(t){var e=this,n=Std.ui("TrayItem",t),i=e.iconSize();return n.parent(e).width(i).height(i),e._items.push(n),e.renderState&&n.render(),n},append:Std.func(function(t){var e=this;e.add(t),e.renderState&&e.update()},{each:[isArray]})},main:function(t,e,n){t._items=[],n.append([t[2]=newDiv("_handle").css({width:e.iconSize,height:e.iconSize}),t[1]=newDiv("_icons")]),e.items&&t.append(e.items)}})}(window,document);